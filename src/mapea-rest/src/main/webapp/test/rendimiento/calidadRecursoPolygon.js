M.proxy(true);

var mapajs = M.map({
  'container': 'mapjs',
  "controls": ["layerswitcher", "mouse", "scale", "overviewmap", "panzoombar", "scaleline", ],
  "getfeatureinfo": "plain"
});


var municipios = new M.layer.WFS({
  name: "Municipios",
  url: "https://clientes.guadaltel.es/desarrollo/geossigc/wfs?",
  namespace: "mapea",
  name: "da_municipio_pol",
  legend: "Municipios - CATEGORÍAS",
  getfeatureinfo: "plain",
  geometry: 'POLYGON',
  extract: true,
});

mapajs.addLayers(municipios);

municipios.on(M.evt.LOAD, () => alert('municipios cargados'));


// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////


// //cloro polygons

let stylesPolygon = [
    new M.style.Polygon({
    fill: {
      color: 'cyan'
    },
    stroke: {
      color: 'cyan',
      width: 1
    }
  }),
  new M.style.Polygon({
    fill: {
      color: '#337CEB'
    },
    stroke: {
      color: '#337CEB',
      width: 1
    }
  }),
  new M.style.Polygon({
    fill: {
      color: '#1f58ad'
    },
    stroke: {
      color: '#1f58ad',
      width: 1
    }
  }),
  new M.style.Polygon({
    fill: {
      color: '#130668'
    },
    stroke: {
      color: '#130668',
      width: 1
    }
  })
];

let choroplethpol = new M.style.Choropleth("area", stylesPolygon, M.style.quantification.JENKS());

function choropleth() {
  let tiempo_ini = calculafecha();
  municipios.setStyle(choroplethpol);
  let tiempo_fin = calculafecha();
  calculadif(tiempo_ini, tiempo_fin);
}

//
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// //////////////////////          Category      /////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
//

//
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
//
// //CATEGORYSTYLE POLYGON
//
//
let verdep = new M.style.Polygon({
  fill: {
    color: 'green',
  },
  stroke: {
    color: '"black"',
  }
});



let amarillop = new M.style.Polygon({
  fill: {
    color: 'yellow',
  },
  stroke: {
    color: '"black"',
  }
});

let rojop = new M.style.Polygon({
  fill: {
    color: 'red',
  },
  stroke: {
    color: '"black"',
  }
});


let azulp = new M.style.Polygon({
  fill: {
    color: 'blue',
  },
  stroke: {
    color: '"black"',
  }
});

let naranjap = new M.style.Polygon({
  fill: {
    color: 'orange',
  },
  stroke: {
    color: '"black"',
  }
});

let marronp = new M.style.Polygon({
  fill: {
    color: 'brown',
  },
  stroke: {
    color: '"black"',
  }
});

let magentap = new M.style.Polygon({
  fill: {
    color: '#e814d9',
  },
  stroke: {
    color: '"black"',
  }
});

let moradop = new M.style.Polygon({
  fill: {
    color: '#b213dd',
  },
  stroke: {
    color: '"black"',
  }
});



let categoryStylep = new M.style.Category("nom_provincia", {
  "ALMERIA": marronp,
  "CADIZ": amarillop,
  "CORDOBA": magentap,
  "GRANADA": verdep,
  "JAEN": naranjap,
  "MALAGA": azulp,
  "SEVILLA": rojop,
  "HUELVA": moradop
});

function categoryStyle() {

  let tiempo_ini = calculafecha();
  municipios.setStyle(categoryStylep);
  let tiempo_fin = calculafecha();
  calculadif(tiempo_ini, tiempo_fin);

}



// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// //////////////////////          Proportional      //////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////

let proportionalpol = new M.style.Proportional('area', 4, 20, new M.style.Point({
  fill: {
    color: 'blue',
    opacity: 0.5
  },
  stroke: {
    color: 'blue'
  }
}));


function Proportional() {
  let tiempo_ini = calculafecha();
  municipios.setStyle(proportionalpol);
  let tiempo_fin = calculafecha();
  calculadif(tiempo_ini, tiempo_fin);
}


function desX() {
  let tiempo_ini = calculafecha();
  municipios.setStyle(amarillop);
  let tiempo_fin = calculafecha();
  calculadif(tiempo_ini, tiempo_fin);
}



function calculadif(tiempo_ini, tiempo_fin) {
  let milisegundos_total = 0;
  let minutos_total = 0;
  let segundos_total = 0;

  let minutos_ini = tiempo_ini.getMinutes();
  let segundos_ini = tiempo_ini.getSeconds();
  let milisegundos_ini = tiempo_ini.getMilliseconds();


  let minutos_fin = tiempo_fin.getMinutes();
  let segundos_fin = tiempo_fin.getSeconds();
  let milisegundos_fin = tiempo_fin.getMilliseconds();

  minutos_total = minutos_fin - minutos_ini;
  segundos_total = segundos_fin - segundos_ini;
  if (milisegundos_fin < milisegundos_ini) {
    milisegundos_total = milisegundos_fin;
  }
  else {
    milisegundos_total = milisegundos_fin - milisegundos_ini;
  }
  console.log("ha tardado: " + minutos_total + " minutos  " + segundos_total + " segundos  " + milisegundos_total + " milisegundos  ")
}


function calculafecha() {
  return new Date();
}
