!function(t){var e={};function n(r){if(e[r])return e[r].exports;var o=e[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(r,o,function(e){return t[e]}.bind(null,o));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=70)}({44:function(t,e){t.exports='<div class="m-control m-drawfeature-container">\n   <button id="m-button-drawfeature" class="g-cartografia-editar2" title="Dibujar"></button>\n</div>'},45:function(t,e){t.exports='<div class="m-control m-modifyfeature-container">\n   <button id="m-button-modifyfeature" class="g-cartografia-flechas-mover" title="Modificar"></button>\n</div>'},46:function(t,e){t.exports='<div class="m-control m-deletefeature-container">\n   <button id="m-button-deletefeature" class="g-cartografia-papelera" title="Eliminar"></button>\n</div>'},47:function(t,e){t.exports='<div class="m-control m-clearfeature-container">\n   <button id="m-button-clearfeature" class="g-cartografia-flecha-deshacer" title="Limpiar"></button>\n</div>'},48:function(t,e){t.exports='<div class="m-control m-savefeature-container">\n   <button id="m-button-savefeature" class="g-cartografia-guardar" title="Guadar"></button>\n</div>'},49:function(t,e){t.exports='<div class="m-editattribute-content">\n    <table>\n        {{#each properties}}\n        <tr>\n            <td>{{key}}:</td>\n            <td>\n                <input id="{{key}}" type="text" value="{{value}}">\n            </td>\n        </tr>\n        {{/each}}\n    </table>\n    <button id="m-button-editattributeSave" class="save"><i class="g-cartografia-guardar"></i> Guardar</button>\n</div>\n'},50:function(t,e){t.exports='<div class="m-control m-editattribute-container">\n   <button id="m-button-editattribute" class="g-cartografia-texto" title="Editar"></button>\n</div>'},51:function(t){t.exports={url:{name:"wfstcontrols",separator:","},constructor:"M.plugin.WFSTControls",parameters:[{type:"array",properties:[{type:"simple",position:0},{type:"simple",position:1},{type:"simple",position:2},{type:"simple",position:3},{type:"simple",position:4}]}],files:{ol:{scripts:["wfstcontrols-2.0.0.ol.min.js"],styles:["wfstcontrols-2.0.0.min.css"]}},metadata:{name:"WFSTControls",description:"Tool for editing WFST layers.",text:"",version:"2.0.0",date:"11/10/2019",author:"Junta de Andalucía",org:"Junta de Andalucía",tags:"mapea,plugin",icon:"./facade/assets/icons/icons.svg"}}},68:function(t,e,n){},70:function(t,e,n){"use strict";n.r(e);n(68);function r(t){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function o(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function i(t,e){return!e||"object"!==r(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function a(t){return(a=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function u(t,e){return(u=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var l=function(t){function e(t){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=i(this,a(e).call(this))).layer_=t,n.interaction_=null,n.modifiedFeatures=[],n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&u(t,e)}(e,M.impl.Control),function(t,e,n){e&&o(t.prototype,e),n&&o(t,n)}(e,[{key:"addTo",value:function(t,e){this.facadeMap_=t,ol.control.Control.call(this,{element:e,target:null}),t.getMapImpl().addControl(this)}},{key:"activate",value:function(){M.utils.isNullOrEmpty(this.interaction_)?(this.createInteraction_(),this.facadeMap_.getMapImpl().addInteraction(this.interaction_),this.interaction_.setActive(!0)):this.interaction_.setActive(!0)}},{key:"deactivate",value:function(){M.utils.isNullOrEmpty(this.interaction_)?(this.createInteraction_(),this.facadeMap_.getMapImpl().addInteraction(this.interaction_),this.interaction_.setActive(!1)):this.interaction_.setActive(!1)}},{key:"createInteraction_",value:function(){}},{key:"destroy",value:function(){this.facadeMap_.getMapImpl().removeControl(this),this.layer_=null,this.interaction_=null,this.modifiedFeatures=null}}]),e}();function c(t){return(c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function s(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function f(t,e){return!e||"object"!==c(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function p(t){return(p=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function y(t,e){return(y=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var d=function(t){function e(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),f(this,p(e).apply(this,arguments))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&y(t,e)}(e,l),function(t,e,n){e&&s(t.prototype,e),n&&s(t,n)}(e,[{key:"createInteraction_",value:function(){var t=this,e=this.layer_.getImpl().getOL3Layer(),n=e.getStyle()()[0],r=[n.getFill(),n.getStroke()],o=r[0],i=r[1],a=new ol.style.Circle({fill:o||i,radius:5,stroke:i});n.getImage()&&(a=n.getImage()),this.interaction_=new ol.interaction.Draw({source:e.getSource(),type:M.geom.parseWFS(this.layer_.geometry),style:new ol.style.Style({image:a,fill:o,stroke:i||new ol.style.Stroke({fill:{color:"#000"}})})}),this.interaction_.on("drawend",function(e){var n=e.feature;t.modifiedFeatures.push(n)},this),this.layer_.on(M.evt.LOAD,this.updateLayerFeatures_.bind(this))}},{key:"updateLayerFeatures_",value:function(){this.facadeMap_.getMapImpl().removeInteraction(this.interaction_),this.interaction_=null}},{key:"deactivate",value:function(){M.utils.isNullOrEmpty(this.interaction_)&&this.createInteraction_(),this.facadeMap_.getMapImpl().removeInteraction(this.interaction_),this.interaction_=null}},{key:"setLayer",value:function(t){this.layer_=t}}]),e}(),h=n(44),b=n.n(h);function m(t){return(m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function v(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function _(t,e){return!e||"object"!==m(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function g(t){return(g=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function O(t,e){return(O=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var w=function(t){function e(t){var n;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var r=new d(t);return(n=_(this,g(e).call(this,r,e.NAME))).name=e.NAME,M.utils.isUndefined(d)&&M.Exception("La implementación usada no puede crear controles DrawFeature"),n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&O(t,e)}(e,M.Control),function(t,e,n){e&&v(t.prototype,e),n&&v(t,n)}(e,[{key:"createView",value:function(t){return M.template.compileSync(b.a,{jsonp:!0})}},{key:"getActivationButton",value:function(t){return t.querySelector("button#m-button-drawfeature")}},{key:"equals",value:function(t){var n=t instanceof e;return n}},{key:"setLayer",value:function(t){this.getImpl().setLayer(t)}}]),e}();function S(t){return(S="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function E(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function j(t,e){return!e||"object"!==S(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function P(t){return(P=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function k(t,e){return(k=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}w.NAME="drawfeature",w.TEMPLATE="drawfeature.html";var F=function(t){function e(t){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=j(this,P(e).call(this))).layer_=t,n.modify=null,n.modifiedFeatures=[],n.currentFeature_=null,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&k(t,e)}(e,M.impl.Control),function(t,e,n){e&&E(t.prototype,e),n&&E(t,n)}(e,[{key:"activate",value:function(){M.utils.isNullOrEmpty(this.modify)&&this.createInteractionModify_(),this.modify.setActive(!0)}},{key:"deactivate",value:function(){M.utils.isNullOrEmpty(this.modify)&&this.createInteractionModify_(),this.facadeMap_.getMapImpl().removeInteraction(this.modify),this.modify=null}},{key:"createInteractionModify_",value:function(){var t=this,e=this.facadeMap_.getMapImpl(),n=this.layer_.getImpl().getOL3Layer(),r=n.getStyle()()[0],o=r.getImage(),i=r.getStroke(),a=r.getFill();null!=o&&(i=o.getStroke());var u=null==i?null:i.clone();null!=u&&u.setColor(M.utils.getRgba(i.getColor())),null==o&&(o=new ol.style.Circle({fill:a||u,radius:5,stroke:i}));var l=new ol.Collection(n.getSource().getFeatures());l.forEach(function(e){e.on("change",function(e){t.currentFeature_=e.target},t)},this),this.modify=new ol.interaction.Modify({features:l,deleteCondition:function(t){return ol.events.condition.shiftKeyOnly(t)&&ol.events.condition.singleClick(t)},style:new ol.style.Style({image:o})}),this.modify.on("modifyend",function(e){var n=t.modifiedFeatures.indexOf(t.currentFeature_);n>=0?t.modifiedFeatures[n]=t.currentFeature_:t.modifiedFeatures.push(t.currentFeature_),t.currentFeature_=null},this),e.addInteraction(this.modify),this.layer_.on(M.evt.LOAD,this.updateLayerFeatures_.bind(this))}},{key:"updateLayerFeatures_",value:function(){this.facadeMap_.getMapImpl().removeInteraction(this.modify),this.modify=null}},{key:"destroy",value:function(){this.facadeMap_.getMapImpl().removeControl(this),this.layer_=null,this.modify=null,this.modifiedFeatures=[]}},{key:"setLayer",value:function(t){this.layer_=t}}]),e}(),T=n(45),C=n.n(T);function N(t){return(N="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function L(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function I(t,e){return!e||"object"!==N(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function x(t){return(x=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function A(t,e){return(A=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var R=function(t){function e(t){var n;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var r=new F(t);return(n=I(this,x(e).call(this,r,e.NAME))).name=e.NAME,n.modify=null,M.utils.isUndefined(F)&&M.exception("La implementación usada no puede crear controles ModifyFeature"),n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&A(t,e)}(e,M.Control),function(t,e,n){e&&L(t.prototype,e),n&&L(t,n)}(e,[{key:"createView",value:function(t){return M.template.compileSync(C.a,{jsonp:!0})}},{key:"getActivationButton",value:function(t){return t.querySelector("button#m-button-modifyfeature")}},{key:"equals",value:function(t){var n=t instanceof e;return n}},{key:"setLayer",value:function(t){this.getImpl().setLayer(t)}}]),e}();function D(t){return(D="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function q(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function U(t,e){return!e||"object"!==D(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function W(t){return(W=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function G(t,e){return(G=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}R.NAME="modifyfeature",R.TEMPLATE="modifyfeature.html";var V=function(t){function e(t){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=U(this,W(e).call(this,t))).layer_=t,n.modifiedFeatures=[],n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&G(t,e)}(e,M.impl.Control),function(t,e,n){e&&q(t.prototype,e),n&&q(t,n)}(e,[{key:"activate",value:function(){this.layer_.on(M.evt.SELECT_FEATURES,this.removeFeature_,this)}},{key:"deactivate",value:function(){this.layer_.un(M.evt.SELECT_FEATURES,this.removeFeature_,this)}},{key:"removeFeature_",value:function(t,e){var n=t[0].getImpl().getOLFeature();if(this.layer_.getImpl().getOL3Layer().getSource().removeFeature(n),M.utils.isNullOrEmpty(n.getId())){var r=this.facadeMap_.getControls("drawfeature")[0];if(!M.utils.isNullOrEmpty(r)){var o=r.getImpl().modifiedFeatures,i=o.indexOf(n);o.splice(i,1)}}else this.modifiedFeatures.push(n)}},{key:"setLayer",value:function(t){this.layer_=t}}]),e}(),z=n(46),B=n.n(z);function H(t){return(H="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Y(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function J(t,e){return!e||"object"!==H(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function X(t){return(X=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function K(t,e){return(K=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var Q=function(t){function e(t){var n;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var r=new V(t);return(n=J(this,X(e).call(this,r,e.NAME))).name=e.NAME,M.utils.isUndefined(V)&&M.exception("La implementación usada no puede crear controles DeleteFeature"),n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&K(t,e)}(e,M.Control),function(t,e,n){e&&Y(t.prototype,e),n&&Y(t,n)}(e,[{key:"createView",value:function(t){return M.template.compileSync(B.a,{jsonp:!0})}},{key:"getActivationButton",value:function(t){return t.querySelector("button#m-button-deletefeature")}},{key:"equals",value:function(t){var n=t instanceof e;return n}},{key:"setLayer",value:function(t){this.getImpl().setLayer(t)}}]),e}();function Z(t){return(Z="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function $(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function tt(t,e){return!e||"object"!==Z(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function et(t,e,n){return(et="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=nt(t)););return t}(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(n):o.value}})(t,e,n||t)}function nt(t){return(nt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function rt(t,e){return(rt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}Q.NAME="deletefeature",Q.TEMPLATE="deletefeature.html";var ot=function(t){function e(t){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=tt(this,nt(e).call(this))).layer_=t,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&rt(t,e)}(e,M.impl.Control),function(t,e,n){e&&$(t.prototype,e),n&&$(t,n)}(e,[{key:"addTo",value:function(t,n){this.facadeMap_=t,et(nt(e.prototype),"addTo",this).call(this,t,n)}},{key:"clear",value:function(){var t=this.facadeMap_.getControls("drawfeature")[0];M.utils.isNullOrEmpty(t)||(t.getImpl().modifiedFeatures.length=0,t.deactivate());var e=this.facadeMap_.getControls("modifyfeature")[0];M.utils.isNullOrEmpty(e)||(e.getImpl().modifiedFeatures.length=0,e.deactivate());var n=this.facadeMap_.getControls("deletefeature")[0];M.utils.isNullOrEmpty(n)||(n.getImpl().modifiedFeatures.length=0,n.deactivate());var r=this.facadeMap_.getControls("editattribute")[0];M.utils.isNullOrEmpty(r)||(r.getImpl().editedFeature=null,r.deactivate()),this.layer_.getImpl().refresh(!0)}},{key:"destroy",value:function(){this.layer_=null,this.facadeMap_.getMapImpl().removeControl(this)}},{key:"setLayer",value:function(t){this.layer_=t}}]),e}(),it=n(47),at=n.n(it);function ut(t){return(ut="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function lt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function ct(t,e){return!e||"object"!==ut(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function st(t){return(st=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function ft(t,e){return(ft=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var pt=function(t){function e(t){var n;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var r=new ot(t);return n=ct(this,st(e).call(this,r,e.NAME)),M.utils.isUndefined(ot)&&M.exception("La implementación usada no puede crear controles ClearFeature"),n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&ft(t,e)}(e,M.Control),function(t,e,n){e&&lt(t.prototype,e),n&&lt(t,n)}(e,[{key:"createView",value:function(t){return M.template.compileSync(at.a,{jsonp:!0})}},{key:"manageActivation",value:function(t){t.querySelector("button#m-button-clearfeature").addEventListener("click",this.clear_.bind(this))}},{key:"equals",value:function(t){var n=t instanceof e;return n}},{key:"clear_",value:function(t){t.preventDefault(),this.getImpl().clear()}},{key:"setLayer",value:function(t){this.getImpl().setLayer(t)}}]),e}();function yt(t){return(yt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function dt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function ht(t,e){return!e||"object"!==yt(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function bt(t,e,n){return(bt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=mt(t)););return t}(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(n):o.value}})(t,e,n||t)}function mt(t){return(mt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function vt(t,e){return(vt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}pt.NAME="clearfeature",pt.TEMPLATE="clearfeature.html";var _t=function(t){function e(t){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=ht(this,mt(e).call(this))).layer_=t,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&vt(t,e)}(e,M.impl.Control),function(t,e,n){e&&dt(t.prototype,e),n&&dt(t,n)}(e,[{key:"addTo",value:function(t,n){this.facadeMap_=t,bt(mt(e.prototype),"addTo",this).call(this,t,n)}},{key:"saveFeature",value:function(){var t=this;this.layer_.getImpl().getDescribeFeatureType().then(function(n){var r=null,o=null,i=null,a=t.facadeMap_.getControls(w.NAME)[0];M.utils.isNullOrEmpty(a)||(r=a.getImpl().modifiedFeatures,e.applyDescribeFeatureType.bind(t)(r,n));var u=t.facadeMap_.getControls(R.NAME)[0];M.utils.isNullOrEmpty(u)||(o=u.getImpl().modifiedFeatures,e.applyDescribeFeatureType.bind(t)(o,n));var l=t.facadeMap_.getControls(Q.NAME)[0];M.utils.isNullOrEmpty(l)||(i=l.getImpl().modifiedFeatures,e.applyDescribeFeatureType.bind(t)(i,n)),M.utils.isNullOrEmpty(o)||o.forEach(function(t){t.unset("bbox")}),M.utils.isNullOrEmpty(r)||r.forEach(function(t){t.unset("bbox")});var c=t.facadeMap_.getProjection().code,s=(new ol.format.WFS).writeTransaction(r,o,i,{featureNS:n.featureNS,featurePrefix:n.featurePrefix,featureType:t.layer_.name,srsName:c,gmlOptions:{srsName:c}}),f=(new XMLSerializer).serializeToString(s);M.remote.post(t.layer_.url,f).then(function(e){t.facadeMap_.getControls(pt.NAME)[0].getImpl().clear(),200===e.code&&-1===e.text.indexOf("ExceptionText")&&-1===e.text.indexOf("<error><descripcion>")?M.dialog.success("Se ha guardado correctamente"):401===e.code?M.dialog.error("Ha ocurrido un error al guardar: Usuario no autorizado"):M.dialog.error("Ha ocurrido un error al guardar: ".concat(e.text))})})}},{key:"destroy",value:function(){this.layer_=null,this.facadeMap_.getMapImpl().removeControl(this)}},{key:"setLayer",value:function(t){this.layer_=t}}],[{key:"applyDescribeFeatureType",value:function(t,e){var n=this.layer_.getImpl();t.forEach(function(t){var r=t.getGeometryName(),o=t.getGeometry();t.set(e.geometryName,o),t.setGeometryName(e.geometryName),t.setGeometry(o),t.unset(r),e.properties.forEach(function(e){if(!M.utils.isGeometryType(e.localType)){var r=t.getProperties()[e.name]||n.getDefaultValue(e.localType);t.set(e.name,r)}})})}}]),e}(),gt=n(48),Ot=n.n(gt);function wt(t){return(wt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Mt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function St(t,e){return!e||"object"!==wt(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function Et(t){return(Et=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function jt(t,e){return(jt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var Pt=function(t){function e(t){var n;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var r=new _t(t);return(n=St(this,Et(e).call(this,r,e.NAME))).name=e.NAME,M.utils.isUndefined(_t)&&M.exception("La implementación usada no puede crear controles SaveFeature"),n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&jt(t,e)}(e,M.Control),function(t,e,n){e&&Mt(t.prototype,e),n&&Mt(t,n)}(e,[{key:"createView",value:function(t){return this.facadeMap_=t,M.template.compileSync(Ot.a,{jsonp:!0})}},{key:"equals",value:function(t){var n=t instanceof e;return n}},{key:"manageActivation",value:function(t){t.querySelector("button#m-button-savefeature").addEventListener("click",this.saveFeature_.bind(this))}},{key:"saveFeature_",value:function(t){t.preventDefault(),this.getImpl().saveFeature()}},{key:"setLayer",value:function(t){this.getImpl().setLayer(t)}}]),e}();Pt.NAME="savefeature",Pt.TEMPLATE="savefeature.html";var kt=n(49),Ft=n.n(kt);function Tt(t){return(Tt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ct(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Nt(t,e){return!e||"object"!==Tt(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function Lt(t,e,n){return(Lt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=It(t)););return t}(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(n):o.value}})(t,e,n||t)}function It(t){return(It=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function xt(t,e){return(xt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var At=function(t){function e(t){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=Nt(this,It(e).call(this))).layer_=t,n.editFeature=null,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&xt(t,e)}(e,M.impl.Control),function(t,e,n){e&&Ct(t.prototype,e),n&&Ct(t,n)}(e,[{key:"activate",value:function(){this.layer_.on(M.evt.SELECT_FEATURES,this.showEditPopup_,this),this.layer_.on(M.evt.UNSELECT_FEATURES,this.unselectFeature_,this)}},{key:"deactivate",value:function(){this.layer_.un(M.evt.SELECT_FEATURES,this.showEditPopup_,this),this.layer_.un(M.evt.UNSELECT_FEATURES,this.unselectFeature_,this)}},{key:"showEditPopup_",value:function(t,n){var r=this;this.unselectFeature_(),this.editFeature=t[0].getImpl().getOLFeature();var o=n.coord;if(M.utils.isNullOrEmpty(this.editFeature.getId()))this.editFeature=null,M.dialog.info("Debe guardar el elemento previamente");else{this.editFeature.setStyle(e.SELECTED_STYLE);var i={properties:[]};Object.keys(this.editFeature.getProperties()).filter(function(t){return"geometry"!==t}).forEach(function(t){i.properties.push({key:t,value:r.editFeature.get(t)})},this);var a={jsonp:!0,vars:i,parseToHtml:!1},u=M.template.compileSync(Ft.a,a),l={icon:"g-cartografia-texto",title:Bt,content:u};if(this.popup_=this.facadeMap_.getPopup(),M.utils.isNullOrEmpty(this.popup_))this.popup_=new M.Popup,this.popup_.addTab(l),this.facadeMap_.addPopup(this.popup_,o);else this.popup_.getTabs().some(function(t){return t.title!==Bt})?this.popup_.addTab(l):(this.facadeMap_.removePopup(),this.popup_=new M.Popup,this.popup_.addTab(l),this.facadeMap_.addPopup(this.popup_,o));var c=this.popup_.getContent().querySelector("button#m-button-editattributeSave");M.utils.isNullOrEmpty(c)||c.addEventListener("click",this.saveAttributes_.bind(this)),this.popup_.on(M.evt.DESTROY,function(){var t=r.popup_.getContent().querySelector("button#m-button-editattributeSave");M.utils.isNullOrEmpty(t)||c.removeEventListener("click",r.saveAttributes_.bind(r)),r.unselectFeature_()},this)}}},{key:"saveAttributes_",value:function(t){var e=this;this.editFeature.unset("bbox",!0);var n=this.popup_.getContent(),r=t.target,o=this.editFeature.getProperties();r.classList.add("m-savefeature-saving"),Object.keys(o).forEach(function(t){if(null!==n.querySelector("input#".concat(t))){var r=n.querySelector("input#".concat(t)).value;e.editFeature.set(t,r,!0)}},this),this.layer_.getImpl().getDescribeFeatureType().then(function(t){var n=e.editFeature.getGeometryName(),o=e.editFeature.getGeometry();e.editFeature.setGeometryName(t.geometryName),e.editFeature.setGeometry(o),e.editFeature.unset(n);var i=e.facadeMap_.getProjection().code,a=(new ol.format.WFS).writeTransaction(null,[e.editFeature],null,{featureNS:t.featureNS,featurePrefix:t.featurePrefix,featureType:e.layer_.name,srsName:i,gmlOptions:{srsName:i}}),u=(new XMLSerializer).serializeToString(a);e.facadeMap_.removePopup(e.popup_),M.remote.post(e.layer_.url,u).then(function(t){r.classList.remove("m-savefeature-saving"),200===t.code?M.dialog.success("Se ha guardado correctamente el elemento"):M.dialog.error("Ha ocurrido un error al guardar: ".concat(t.text))})})}},{key:"unselectFeature_",value:function(){null!==this.editFeature&&(this.editFeature.setStyle(M.impl.layer.WFS.STYLE),this.editFeature=null,this.facadeMap_.removePopup())}},{key:"destroy",value:function(){Lt(It(e.prototype),"destroy",this).call(this),M.utils.isNull(this.facadeMap_)||M.utils.isNull(this.facadeMap_.getPopup())||this.facadeMap_.removePopup()}},{key:"setLayer",value:function(t){this.layer_=t}}]),e}();At.SELECTED_STYLE=new ol.style.Style({fill:new ol.style.Fill({color:"rgba(175, 127, 19, 0.2)"}),stroke:new ol.style.Stroke({color:"#af7f13",width:2}),image:new ol.style.Circle({radius:7,fill:new ol.style.Fill({color:"#af7f13"})})});var Rt=n(50),Dt=n.n(Rt);function qt(t){return(qt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ut(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Wt(t,e){return!e||"object"!==qt(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function Gt(t){return(Gt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Vt(t,e){return(Vt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var zt=function(t){function e(t){var n;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var r=new At(t);return(n=Wt(this,Gt(e).call(this,r,e.NAME))).name=e.NAME,M.utils.isUndefined(At)&&M.exception("La implementación usada no puede crear controles EditAttribute"),n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Vt(t,e)}(e,M.Control),function(t,e,n){e&&Ut(t.prototype,e),n&&Ut(t,n)}(e,[{key:"createView",value:function(t){return M.template.compileSync(Dt.a,{jsonp:!0})}},{key:"getActivationButton",value:function(t){return t.querySelector("button#m-button-editattribute")}},{key:"equals",value:function(t){var n=t instanceof e;return n}},{key:"setLayer",value:function(t){this.getImpl().setLayer(t)}}]),e}();zt.NAME="editattribute";var Bt="Editattribute";zt.TEMPLATE="editattribute.html";var Ht=n(51);function Yt(t){return(Yt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Jt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Xt(t,e){return!e||"object"!==Yt(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function Kt(t){return(Kt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Qt(t,e){return(Qt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var Zt=function(t){function e(t,n){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(r=Xt(this,Kt(e).call(this))).controls=t,r.controls_=[],r.name=e.NAME,r.layername_=n,r.map_=null,r.drawfeature_=null,r.modifyfeature_=null,r.deletefeature_=null,r.clearfeature_=null,r.savefeature_=null,r.editattibute_=null,r.metadata_=Ht.metadata,r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Qt(t,e)}(e,M.Plugin),function(t,e,n){e&&Jt(t.prototype,e),n&&Jt(t,n)}(e,[{key:"addTo",value:function(t){this.map_=t;var e=this.map_.getWFS()[0],n=this.map_.getWFS({name:this.layername_})[0],r=M.utils.isNullOrEmpty(n)?e:n;if(M.utils.isNullOrEmpty(r))M.dialog.error("Los controles <b>".concat(this.controls.join(","),"</b> no se pueden añadir al mapa porque no existe una capa WFS cargada."));else{for(var o=!1,i=!1,a=0,u=this.controls.length;a<u;a+=1)"drawfeature"===this.controls[a]?(this.drawfeature_=new w(r),t.addControls([this.drawfeature_]),this.controls_.push(this.drawfeature_),o=!0,i=!0):"modifyfeature"===this.controls[a]?(this.modifyfeature_=new R(r),t.addControls([this.modifyfeature_]),this.controls_.push(this.modifyfeature_),o=!0,i=!0):"deletefeature"===this.controls[a]?(this.deletefeature_=new Q(r),t.addControls([this.deletefeature_]),this.controls_.push(this.deletefeature_),o=!0,i=!0):"editattribute"===this.controls[a]&&(this.editattibute_=new zt(r),t.addControls([this.editattibute_]),this.controls_.push(this.editattibute_),i=!0);o&&(this.savefeature_=new Pt(r),t.addControls([this.savefeature_]),this.controls_.push(this.savefeature_)),i&&(this.clearfeature_=new pt(r),t.addControls([this.clearfeature_]),this.controls_.push(this.clearfeature_))}}},{key:"getControls",value:function(){return this.controls_}},{key:"destroy",value:function(){this.map_.removeControls([this.drawfeature_,this.modifyfeature_,this.deletefeature_,this.clearfeature_,this.savefeature_,this.editattibute_]),this.controls=null,this.map_=null,this.drawfeature_=null,this.modifyfeature_=null,this.deletefeature_=null,this.clearfeature_=null,this.savefeature_=null,this.editattibute_=null}},{key:"setLayer",value:function(t){this.layername_=t;var e=this.map_.getWFS({name:this.layername_})[0];if(M.utils.isNullOrEmpty(e))M.dialog.error("Los capa <b>".concat(t,"</b> no es una capa WFS cargada."));else{var n=[];M.utils.isNullOrEmpty(this.drawfeature_)||n.push(this.drawfeature_),M.utils.isNullOrEmpty(this.modifyfeature_)||n.push(this.modifyfeature_),M.utils.isNullOrEmpty(this.deletefeature_)||n.push(this.deletefeature_),M.utils.isNullOrEmpty(this.clearfeature_)||n.push(this.clearfeature_),M.utils.isNullOrEmpty(this.savefeature_)||n.push(this.savefeature_),M.utils.isNullOrEmpty(this.editattibute_)||n.push(this.editattibute_),this.clearfeature_.getImpl().clear(),n.forEach(function(t){return t.setLayer(e)})}}},{key:"equals",value:function(t){return t instanceof e}},{key:"getAPIRest",value:function(){return"wfstcontrols=".concat(this.controls.join(","))}},{key:"getMetadata",value:function(){return this.metadata_}}]),e}();Zt.NAME="wfstcontrols",null==window.M.plugin&&(window.M.plugin={}),window.M.plugin.WFSTControls=Zt}});