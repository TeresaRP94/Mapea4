!function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=78)}({0:function(e,t,n){"use strict";function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var o=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return function(e,t,n){t&&r(e.prototype,t),n&&r(e,n)}(e,null,[{key:"init",value:function(){if(!1===e.initialized){e.initialized=!0;var t=document.createElement("img");t.src=M.utils.concatUrlPaths([M.config.THEME_URL,"/img/m-pin-24.svg"]),t.width="24",t.height="24",t.crossOrigin="anonymous";var n=document.createElement("IMG");n.src=M.utils.concatUrlPaths([M.config.THEME_URL,"/img/m-pin-24-new.svg"]),n.width="24",n.height="24",n.crossOrigin="anonymous";var r=document.createElement("IMG");r.src=M.utils.concatUrlPaths([M.config.THEME_URL,"/img/m-pin-24-sel.svg"]),r.width="24",r.height="24",r.crossOrigin="anonymous",e.DEFAULT[M.geom.wkt.type.POINT]=new ol.style.Style({image:new ol.style.Icon({img:t,imgSize:[24,24]})}),e.DEFAULT[M.geom.wkt.type.LINE_STRING]=new ol.style.Style({fill:new ol.style.Fill({color:"#A15BD7"}),stroke:new ol.style.Stroke({color:"#A15BD7",width:2})}),e.DEFAULT[M.geom.wkt.type.POLYGON]=new ol.style.Style({image:new ol.style.Icon({img:t,imgSize:[24,24]})}),e.DEFAULT[M.geom.wkt.type.MULTI_POINT]=e.DEFAULT[M.geom.wkt.type.POINT],e.DEFAULT[M.geom.wkt.type.LINEAR_RING]=e.DEFAULT[M.geom.wkt.type.LINE_STRING],e.DEFAULT[M.geom.wkt.type.MULTI_LINE_STRING]=e.DEFAULT[M.geom.wkt.type.LINE_STRING],e.DEFAULT[M.geom.wkt.type.MULTI_POLYGON]=e.DEFAULT[M.geom.wkt.type.POLYGON],e.DEFAULT[M.geom.wkt.type.CIRCLE]=e.DEFAULT[M.geom.wkt.type.POLYGON],e.DEFAULT[M.geom.wkt.type.GEOMETRY_COLLECTION]=e.DEFAULT[M.geom.wkt.type.POLYGON],e.NEW[M.geom.wkt.type.POINT]=new ol.style.Style({image:new ol.style.Icon({img:n,imgSize:[24,24]})}),e.NEW[M.geom.wkt.type.LINE_STRING]=new ol.style.Style({fill:new ol.style.Fill({color:"#e2951b"}),stroke:new ol.style.Stroke({color:"#e2951b",width:2})}),e.NEW[M.geom.wkt.type.POLYGON]=new ol.style.Style({image:new ol.style.Icon({img:n,imgSize:[24,24]})}),e.NEW[M.geom.wkt.type.MULTI_POINT]=e.NEW[M.geom.wkt.type.POINT],e.NEW[M.geom.wkt.type.LINEAR_RING]=e.NEW[M.geom.wkt.type.LINE_STRING],e.NEW[M.geom.wkt.type.MULTI_LINE_STRING]=e.NEW[M.geom.wkt.type.LINE_STRING],e.NEW[M.geom.wkt.type.MULTI_POLYGON]=e.NEW[M.geom.wkt.type.POLYGON],e.NEW[M.geom.wkt.type.CIRCLE]=e.NEW[M.geom.wkt.type.POLYGON],e.NEW[M.geom.wkt.type.GEOMETRY_COLLECTION]=e.NEW[M.geom.wkt.type.POLYGON],e.SELECTED[M.geom.wkt.type.POINT]=new ol.style.Style({image:new ol.style.Icon({img:r,imgSize:[24,24]})}),e.SELECTED[M.geom.wkt.type.LINE_STRING]=new ol.style.Style({fill:new ol.style.Fill({color:"#fcfcfc"}),stroke:new ol.style.Stroke({color:"#3589d1",width:2})}),e.SELECTED[M.geom.wkt.type.POLYGON]=new ol.style.Style({fill:new ol.style.Fill({color:"rgba(240, 220, 255, 0.2)"}),stroke:new ol.style.Stroke({color:"#a15bd7",width:2})}),e.SELECTED[M.geom.wkt.type.MULTI_POINT]=e.SELECTED[M.geom.wkt.type.POINT],e.SELECTED[M.geom.wkt.type.LINEAR_RING]=e.SELECTED[M.geom.wkt.type.LINE_STRING],e.SELECTED[M.geom.wkt.type.MULTI_LINE_STRING]=e.SELECTED[M.geom.wkt.type.LINE_STRING],e.SELECTED[M.geom.wkt.type.MULTI_POLYGON]=e.SELECTED[M.geom.wkt.type.POLYGON],e.SELECTED[M.geom.wkt.type.CIRCLE]=e.SELECTED[M.geom.wkt.type.POLYGON],e.SELECTED[M.geom.wkt.type.GEOMETRY_COLLECTION]=e.SELECTED[M.geom.wkt.type.POLYGON]}}}]),e}();function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}o.DEFAULT={},o.NEW={},o.SELECTED={},o.initialized=!1;var l=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return function(e,t,n){t&&s(e.prototype,t),n&&s(e,n)}(e,null,[{key:"getCentroidCoordinate",value:function(t){var n,r,o,s,l,a;return t.getType()===M.geom.wkt.type.POINT?n=t.getCoordinates():t.getType()===M.geom.wkt.type.LINE_STRING?n=(r=t.getCoordinates())[o=Math.floor(r.length/2)]:t.getType()===M.geom.wkt.type.LINEAR_RING?n=(r=t.getCoordinates())[o=Math.floor(r.length/2)]:t.getType()===M.geom.wkt.type.POLYGON?n=e.getCentroidCoordinate(t.getInteriorPoint()):t.getType()===M.geom.wkt.type.MULTI_POINT?(s=t.getPoints(),o=Math.floor(s.length/2),n=e.getCentroidCoordinate(s[o])):t.getType()===M.geom.wkt.type.MULTI_LINE_STRING?(l=t.getLineStrings(),o=Math.floor(l.length/2),n=e.getCentroidCoordinate(l[o])):t.getType()===M.geom.wkt.type.MULTI_POLYGON?(s=t.getInteriorPoints(),n=e.getCentroidCoordinate(s)):t.getType()===M.geom.wkt.type.CIRCLE?n=t.getCenter():t.getType()===M.geom.wkt.type.GEOMETRY_COLLECTION&&(a=t.getGeometries(),o=Math.floor(a.length/2),n=e.getCentroidCoordinate(a[o])),n}}]),e}(),a=n(4),i=n.n(a);function u(e){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function p(e,t){return!t||"object"!==u(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function h(e,t,n){return(h="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=y(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function y(e){return(y=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function f(e,t){return(f=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var m=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"geosearch",r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var o=r;return(e=p(this,y(t).call(this,o))).wktFormatter_=new ol.format.WKT,e.popup_=null,e.selectedFeatures_=[],o.displayInLayerSwitcher||(o.displayInLayerSwitcher=!1),e.name=n,e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&f(e,t)}(t,M.impl.layer.Vector),function(e,t,n){t&&c(e.prototype,t),n&&c(e,n)}(t,[{key:"addTo",value:function(e){h(y(t.prototype),"addTo",this).call(this,e),this.ol3Layer.setSource(new ol.source.Vector({useSpatialIndex:!1}))}},{key:"drawResults",value:function(e){var n=this,r=ol.proj.get(this.map.getProjection().code),o=[];M.utils.isNullOrEmpty(e.spatial_response)||(o=e.spatial_response.docs),M.utils.isNullOrEmpty(o)&&(o=e.response.docs);var s=o.map(function(e){var o=n.wktFormatter_.readFeature(e.geom,{dataProjection:r});return o.setId(e.solrid),o.setProperties(e),t.setStyleFeature(o,M.style.state.DEFAULT),n.wrapComplexFeature_(o),M.impl.Feature.olFeature2Facade(o)},this);this.facadeVector_.addFeatures(s)}},{key:"drawNewResults",value:function(e){var n,r=this,o=ol.proj.get(this.map.getProjection().code);M.utils.isNullOrEmpty(e.spatial_response)?M.utils.isNullOrEmpty(e.response)||(n=e.response.docs):n=e.spatial_response.docs;var s=n.map(function(e){var n=r.wktFormatter_.readFeature(e.geom,{dataProjection:o});return n.setId(e.solrid),n.setProperties(e),t.setStyleFeature(n,M.style.state.NEW),M.impl.Feature.olFeature2Facade(n)},this);this.facadeVector_.addFeatures(s)}},{key:"clear",value:function(e){this.map.removePopup(),this.facadeVector_.clear()}},{key:"selectFeatures",value:function(e,n,r,o){var s=this,l=e;this.unselectFeatures(),this.selectedFeatures_=l,l=l.map(M.impl.Feature.facade2OLFeature),t.setStyleFeature(l,M.style.state.SELECTED);var a={jsonp:!0,vars:this.parseFeaturesForTemplate_(l),parseToHtml:!1},u={icon:"g-cartografia-pin",title:"Geosearch",content:M.template.compileSync(i.a,a)},c=this.map.getPopup();M.utils.isNullOrEmpty(c)?((c=new M.Popup({panMapIfOutOfView:!o,ani:null})).addTab(u),this.map.addPopup(c,n)):c.addTab(u),c.on(M.evt.DESTROY,function(){s.internalUnselectFeatures_(!0)},this)}},{key:"selectFeatureBySolrid",value:function(e){var t=this.facadeVector_.getFeatureById(e);this.selectedFeatures_=[t];var n=t.getImpl().getOLFeature().getGeometry(),r=l.getCentroidCoordinate(n);this.unselectFeatures(),this.selectFeatures([t],r,null,!0),this.map.setBbox(n.getExtent())}},{key:"parseFeaturesForTemplate_",value:function(e){var t={features:[]};return e.forEach(function(e){var n=["geom","_version_","keywords","solrid",e.getGeometryName()],r=e.getProperties(),o=[];Object.keys(r).forEach(function(e){M.utils.includes(n,e.toLowerCase())||o.push({key:M.utils.beautifyAttributeName(e),value:r[e]})});var s={solrid:e.getId(),attributes:o};t.features.push(s)}),t}},{key:"wrapComplexFeature_",value:function(e){var t=e.getGeometry();if(t.getType()===M.geom.wkt.type.POLYGON||t.getType()===M.geom.wkt.type.MULTI_POLYGON){var n;n=t.getType()===M.geom.wkt.type.POLYGON?t.getInteriorPoint():t.getInteriorPoints();var r=new ol.geom.GeometryCollection([n,t]);e.setGeometry(r)}}},{key:"unselectFeatures",value:function(e,t){this.internalUnselectFeatures_()}},{key:"internalUnselectFeatures_",value:function(e){this.selectedFeatures_.length>0&&(t.setStyleFeature(this.selectedFeatures_.map(M.impl.Feature.facade2OLFeature),M.style.state.DEFAULT),this.selectedFeatures_.length=0,e||this.map.removePopup())}},{key:"setNewResultsAsDefault",value:function(){t.setStyleFeature(this.facadeVector_.getFeatures().map(M.impl.Feature.facade2OLFeature),M.style.state.DEFAULT)}},{key:"getCentroidCoordinate",value:function(e){var t,n,r,o,s,l;return e.getType()===M.geom.wkt.type.POINT?t=e.getCoordinates():e.getType()===M.geom.wkt.type.LINE_STRING?t=(n=e.getCoordinates())[r=Math.floor(n.length/2)]:e.getType()===M.geom.wkt.type.LINEAR_RING?t=(n=e.getCoordinates())[r=Math.floor(n.length/2)]:e.getType()===M.geom.wkt.type.POLYGON?t=this.getCentroidCoordinate(e.getInteriorPoint()):e.getType()===M.geom.wkt.type.MULTI_POINT?(o=e.getPoints(),r=Math.floor(o.length/2),t=this.getCentroidCoordinate(o[r])):e.getType()===M.geom.wkt.type.MULTI_LINE_STRING?(s=e.getLineStrings(),r=Math.floor(s.length/2),t=this.getCentroidCoordinate(s[r])):e.getType()===M.geom.wkt.type.MULTI_POLYGON?(o=e.getInteriorPoints(),t=this.getCentroidCoordinate(o)):e.getType()===M.geom.wkt.type.CIRCLE?t=e.getCenter():e.getType()===M.geom.wkt.type.GEOMETRY_COLLECTION&&(l=e.getGeometries(),r=Math.floor(l.length/2),t=this.getCentroidCoordinate(l[r])),t}},{key:"destroy",value:function(){var e=this.map.getMapImpl();M.utils.isNullOrEmpty(this.ol3Layer)||(e.removeLayer(this.ol3Layer),this.ol3Layer=null),this.map=null,this.wktFormatter_=null,this.popup_=null,this.selectedFeatures_=null,this.name=null}},{key:"equals",value:function(e){var n=!1;return e instanceof t&&(n=this.url===e.url,n=n&&this.name===e.name),n}},{key:"getFeaturesExtentPromise",value:function(e,t){var n=this;return new Promise(function(r){var o=n.map.getProjection().code;if(!0===n.isLoaded()){var s=n.getFeatures(e,t),l=M.impl.utils.getFeaturesExtent(s,o);r(l)}else n.requestFeatures_().then(function(e){var t=M.impl.utils.getFeaturesExtent(e,o);r(t)})})}}],[{key:"setStyleFeature",value:function(e,t){var n=e;o.init(),M.utils.isArray(n)||(n=[n]),n.forEach(function(e){var n=e.getGeometry().getType();M.utils.isNullOrEmpty(t)||t===M.style.state.DEFAULT?e.setStyle(o.DEFAULT[n]):t===M.style.state.NEW?e.setStyle(o.NEW[n]):t===M.style.state.SELECTED&&e.setStyle(o.SELECTED[n])})}}]),t}();function d(e){return(d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function g(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _(e,t){return!t||"object"!==d(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function v(e){return(v=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function E(e,t){return(E=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}m.POPUP_RESULT="geosearchfeaturepopup.html";var w=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new m;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),e=_(this,v(t).call(this,n,r,{},o)),M.utils.isUndefined(m)&&M.exception("La implementación usada no puede crear capas Geosearch"),e.displayInLayerSwitcher=!1,e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&E(e,t)}(t,M.layer.Vector),function(e,t,n){t&&g(e.prototype,t),n&&g(e,n)}(t,[{key:"equals",value:function(e){return!1}}]),t}();function b(e){return(b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function L(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function S(e,t){return!t||"object"!==b(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function k(e){return(k=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function T(e,t){return(T=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}n.d(t,"a",function(){return O});var O=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=S(this,k(t).call(this))).facadeMap_=null,e.helpHtml_=null,e.layer_=new w({name:n.layerName}),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&T(e,t)}(t,M.impl.Control),function(e,t,n){t&&L(e.prototype,t),n&&L(e,n)}(t,[{key:"addTo",value:function(e,t){this.facadeMap_=e,e.addLayers(this.layer_),ol.control.Control.call(this,{element:t,target:null}),e.getMapImpl().addControl(this)}},{key:"unselectResults",value:function(e){this.layer_.getImpl().unselectFeatures(e)}},{key:"setNewResultsAsDefault",value:function(){this.layer_.getImpl().setNewResultsAsDefault()}},{key:"drawResults",value:function(e){this.layer_.getImpl().drawResults(e)}},{key:"drawNewResults",value:function(e){this.layer_.getImpl().drawNewResults(e)}},{key:"zoomToResults",value:function(){var e=ol.extent.boundingExtent(this.layer_.getImpl().getOL3Layer().getSource().getFeatures().map(function(e){return ol.extent.getCenter(e.getGeometry().getExtent())}));this.facadeMap_.setBbox(e)}},{key:"getLayer",value:function(){return this.layer_}},{key:"resultClick",value:function(e){this.layer_.getImpl().selectFeatureBySolrid(e)}},{key:"hideHelp",value:function(){M.utils.isNullOrEmpty(this.helpHtml_)||(this.facadeMap_.getMapImpl().getTargetElement().removeChild(this.helpHtml_),this.helpHtml_=null)}},{key:"showHelp",value:function(e){var t=this.facadeMap_.getMapImpl().getTargetElement();M.utils.isNullOrEmpty(this.helpHtml_)||t.removeChild(this.helpHtml_),this.helpHtml_=e,t.appendChild(this.helpHtml_)}},{key:"clear",value:function(){this.layer_.clear()}},{key:"destroy",value:function(){this.clear(),this.facadeMap_.areasContainer.getElementsByClassName("m-top m-right")[0].classList.remove("top-extra"),this.facadeMap_.getMapImpl().removeControl(this),this.facadeMap_=null,this.helpHtml_=null,this.layer_=null}}]),t}()},1:function(e,t){e.exports='<div class="results-panels">\n   {{#if partial}}\n   <div class="partial">\n      <p>No se han encontrado resultados para la búsqueda.</p>\n      <p>A continuación se muestran otros resultados que quizás le interesen:...</p>\n   </div>\n   {{/if}}\n   <div class="results" id="m-geosearch-results-scroll">\n      {{#each docs}}\n      <div id="{{solrid}}" class="result">\n         {{#each attributes}}\n         <table>\n            <tbody>\n               <tr>\n                  <td class="key">{{key}}</td>\n                  <td class="value{{#oneword value}} m-wordbreak{{/oneword}}">{{{value}}}</td>\n               </tr>\n            </tbody>\n         </table>\n         {{/each}}\n      </div>\n      {{/each}}\n   </div>\n   {{#eq docs.length 0}}\n   <div class="results">\n      <div class="partial">No se han encontrado resultados para la búsqueda "{{query}}".</div>\n   </div>\n   {{/eq}}\n   <div class="page">\n      <span class="found" id="m-geosearch-page-found">{{docs.length}}</span> de <span class="total">{{total}}</span>\n      <div class="g-cartografia-flecha-arriba"></div>\n   </div>\n</div>'},2:function(e,t,n){"use strict";n.d(t,"a",function(){return m});var r=n(0),o=n(5),s=n.n(o),l=n(1),a=n.n(l),i=n(6),u=n.n(i);function c(e){return(c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function p(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function h(e,t){return!t||"object"!==c(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function y(e){return(y=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function f(e,t){return(f=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var m=function(e){function t(e,n,o,s,l){var a;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var i=new r.a;return a=h(this,y(t).call(this,i,t.NAME)),M.utils.isUndefined(r.a)&&M.exception("La implementación usada no puede crear controles Geosearch"),a.input_=null,a.element_=null,a.resultsContainer_=null,a.resultsScrollContainer_=null,a.searchingResult_=null,a.searchTime_=0,a.url_=e,a.core_=n,a.handler_=o,a.searchUrl_=M.utils.concatUrlPaths([a.url_,a.core_,a.handler_]),a.helpUrl_=M.utils.concatUrlPaths([a.url_,a.core_,"/help"]),a.searchParameters_=s,M.utils.isNullOrEmpty(a.searchParameters_)||(M.utils.isNullOrEmpty(a.searchParameters_.rows)&&(a.searchParameters_.rows=M.config.GEOSEARCH_ROWS),a.searchUrl_=M.utils.addParameters(a.searchUrl_,a.searchParameters_)),a.results_=[],a.showHelp_=l,a.scrollIsUp_=!0,a.spatialSearch_=!1,a.facadeMap_=null,a}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&f(e,t)}(t,M.Control),function(e,t,n){t&&p(e.prototype,t),n&&p(e,n)}(t,[{key:"createView",value:function(e){this.facadeMap_=e;var t=M.template.compileSync(s.a,{jsonp:!0});return!1===this.showHelp_&&t.querySelector("#m-geosearch-help-btn").classList.add("m-hidden"),this.addEvents(t),t}},{key:"addEvents",value:function(e){var t=this;this.element_=e,this.on(M.evt.COMPLETED,function(){t.element_.classList.add("shown")},this),this.input_=this.element_.getElementsByTagName("input")["m-geosearch-search-input"],this.input_.addEventListener("keyup",this.searchClick.bind(this)),this.element_.getElementsByTagName("button")["m-geosearch-search-btn"].addEventListener("click",this.searchClick.bind(this));var n=this.element_.getElementsByTagName("button")["m-geosearch-help-btn"];n&&n.addEventListener("click",function(e){e.preventDefault(),n.classList.toggle("shown"),t.helpClick_()}),this.element_.getElementsByTagName("button")["m-geosearch-clear-btn"].addEventListener("click",this.clearClick_.bind(this)),this.resultsContainer_=this.element_.querySelector("div#m-geosearch-results"),M.utils.enableTouchScroll(this.resultsContainer_),this.searchingResult_=this.element_.querySelector("div#m-geosearch-results > div#m-searching-result")}},{key:"addEventsHelp",value:function(e){this.element_=e,this.element_.getElementsByTagName("button")["m-geosearch-closeHelp-btn"].addEventListener("click",this.closeHelpClick_.bind(this))}},{key:"searchClick",value:function(e){if(e.preventDefault(),"keyup"!==e.type||13===e.keyCode){this.results_.length=0;var t=this.input_.value;M.utils.isNullOrEmpty(t)?M.dialog.info("Debe introducir una búsqueda."):this.search_(t,this.showResults_)}}},{key:"resultClick_",value:function(e){var t=e;t.preventDefault(),M.window.WIDTH<=M.config.MOBILE_WIDTH&&(t.target=this.resultsContainer_.querySelector("div.page > div.g-cartografia-flecha-arriba"),this.resultsClick_(t)),this.facadeMap_.removePopup();var n=t.currentTarget.id;this.getImpl().resultClick(n)}},{key:"search_",value:function(e,n){var r=this;this.resultsContainer_.appendChild(this.searchingResult_),this.searchTime_=Date.now(),this.element_.classList.add(t.SEARCHING_CLASS);var o=M.utils.addParameters(this.searchUrl_,{q:e,start:this.results_.length,srs:this.facadeMap_.getProjection().code});!function(e){M.remote.get(o).then(function(o){if(e===r.searchTime_){var s;try{s=JSON.parse(o.text)}catch(e){M.exception("La respuesta no es un JSON válido: ".concat(e))}n.call(r,s),r.element_.classList.remove(t.SEARCHING_CLASS)}})}(this.searchTime_)}},{key:"showResults_",value:function(e){this.getImpl().clear(),this.drawResults(e);var n={jsonp:!0,vars:this.parseResultsForTemplate_(e)},r=M.template.compileSync(a.a,n);this.resultsContainer_.classList.remove(t.HIDDEN_RESULTS_CLASS),M.utils.isNullOrEmpty(this.resultsScrollContainer_)||this.resultsScrollContainer_.removeEventListener("scroll",this.resultsScroll_);for(var o=this.resultsContainer_.querySelectorAll(".result"),s=0,l=o.length;s<l;s+=1)o.item(s).removeEventListener("click",this.resultClick_.bind(this));e.response.docs.length>0&&this.zoomToResults();var i=this.resultsContainer_.querySelector("div.page > div.g-cartografia-flecha-arriba");M.utils.isNullOrEmpty(i)||i.removeEventListener("click",this.resultsClick_.bind(this)),this.resultsContainer_.innerHTML=r.innerHTML,this.resultsScrollContainer_=this.resultsContainer_.querySelector("div#m-geosearch-results-scroll"),M.utils.enableTouchScroll(this.resultsScrollContainer_),this.resultsScrollContainer_.addEventListener("scroll",this.resultsScroll_.bind(this));for(var u=0,c=(o=this.resultsContainer_.getElementsByClassName("result")).length;u<c;u+=1)o.item(u).addEventListener("click",this.resultClick_.bind(this));(i=this.resultsContainer_.querySelector("div.page > div.g-cartografia-flecha-arriba")).addEventListener("click",this.resultsClick_.bind(this)),this.checkScrollSearch_(e),this.fire(M.evt.COMPLETED)}},{key:"drawResults",value:function(e){this.getImpl().drawResults(e)}},{key:"drawNewResults",value:function(e){this.getImpl().drawNewResults(e)}},{key:"zoomToResults",value:function(){this.getImpl().zoomToResults()}},{key:"getInput",value:function(){return this.input_}},{key:"appendResults_",value:function(e){var t=this;this.drawNewResults(e);for(var n={jsonp:!0,vars:this.parseResultsForTemplate_(e,!0)},r=M.template.compileSync(a.a,n).getElementsByTagName("div")["m-geosearch-results-scroll"].children,o=0;o<r.length;o+=1){var s=r.item(o);this.resultsScrollContainer_.appendChild(s),s.addEventListener("click",function(e){return t.resultClick_(e)})}this.resultsContainer_.getElementsByTagName("span")["m-geosearch-page-found"].innerHTML=this.results_.length,this.checkScrollSearch_(e)}},{key:"resultsScroll_",value:function(e){var t=e.target,n=t.offsetHeight,r=t.scrollHeight-t.scrollTop-n<=15;r&&this.scrollIsUp_?(this.scrollIsUp_=!1,this.scrollSearch_()):r||(this.scrollIsUp_=!0)}},{key:"scrollSearch_",value:function(){this.getImpl().unselectResults(!0),this.getImpl().setNewResultsAsDefault();var e=this.input_.value;this.search_(e,this.appendResults_)}},{key:"helpClick_",value:function(e){var t=this;!0===this.helpShown_?(this.getImpl().hideHelp(),this.helpShown_=!1):M.remote.get(this.helpUrl_).then(function(e){var n;try{n=JSON.parse(e.text)}catch(e){M.Exception("La respuesta no es un JSON válido: ".concat(e))}var r={jsonp:!0,vars:{entities:n}},o=M.template.compileSync(u.a,r);t.addEventsHelp(o),t.getImpl().showHelp(o),t.helpShown_=!0})}},{key:"closeHelpClick_",value:function(e){!0===this.helpShown_&&(this.getImpl().hideHelp(),this.helpShown_=!1)}},{key:"clearClick_",value:function(e){this.element_.classList.remove("shown"),M.utils.isNullOrEmpty(this.input_)||(this.input_.value=""),M.utils.isNullOrEmpty(this.resultsContainer_)||(this.resultsContainer_.innerHTML=""),M.utils.isNullOrEmpty(this.resultsScrollContainer_)||(this.resultsScrollContainer_.innerHTML="",this.resultsScrollContainer_=null),this.results_.length=0,this.resultsContainer_.classList.remove(t.HIDDEN_RESULTS_CLASS),this.getImpl().clear(),this.getImpl().hideHelp(),this.spatialSearch_=!1}},{key:"resultsClick_",value:function(e){this.facadeMap_.areasContainer.getElementsByClassName("m-top m-right")[0].classList.add("top-extra-search"),e.target.classList.toggle("g-cartografia-flecha-arriba"),e.target.classList.toggle("g-cartografia-flecha-abajo"),this.resultsContainer_.classList.toggle(t.HIDDEN_RESULTS_CLASS)}},{key:"equals",value:function(e){var n=!1;return e instanceof t&&(n=this.name===e.name),n}},{key:"parseResultsForTemplate_",value:function(e,t){var n="";M.utils.isNullOrEmpty(this.input_)||(n=this.input_.value);var r=0;M.utils.isUndefined(e.spatial_response)?(r=e.response.numFound,this.spatialSearch_=!1):(r=e.spatial_response.numFound,this.spatialSearch_=!0);var o=this.getDocsFromResults_(e);this.results_=!0===t?this.results_.concat(o):o;var s=this.spatialSearch_&&M.utils.isNullOrEmpty(e.spatial_response.docs);return 0!==r?{docs:o,total:r,partial:s}:{docs:o,total:r,notResutls:!0,query:n}}},{key:"getDocsFromResults_",value:function(e){var t=["geom","_version_","keywords","solrid"];return(this.spatialSearch_?e.spatial_response.docs:e.response.docs).map(function(e){var n=[];return Object.keys(e).forEach(function(r){M.utils.includes(t,r)||n.push({key:M.utils.beautifyAttributeName(r),value:e[r]})}),{solrid:e.solrid,attributes:n}})}},{key:"checkScrollSearch_",value:function(e){var t=0;t=M.utils.isUndefined(e.spatial_response)?e.response.numFound:e.spatial_response.numFound,this.results_.length!==t||M.utils.isNullOrEmpty(this.resultsScrollContainer_)||this.resultsScrollContainer_.removeEventListener("scroll",this.resultsScroll_)}}]),t}();m.NAME="geosearch",m.TEMPLATE="geosearch.html",m.RESULTS_TEMPLATE="geosearchresults.html",m.HELP_TEMPLATE="geosearchhelp.html",m.SEARCHING_CLASS="m-searching",m.HIDDEN_RESULTS_CLASS="hidden"},20:function(e){e.exports={url:{name:"geosearch",separator:"*"},constructor:"M.plugin.Geosearch",parameters:[{type:"object",properties:[{type:"simple",name:"url",position:0},{type:"simple",name:"core",position:1},{type:"simple",name:"handler",position:2}]}],files:{ol:{scripts:["geosearch-2.0.0.ol.min.js"],styles:["geosearch-2.0.0.min.css"]}},metadata:{name:"Geosearch",description:"",text:"",version:"2.0.0",date:"11/10/2019",author:"Junta de Andalucía",org:"Junta de Andalucía",tags:"mapea,plugin",icon:"./facade/assets/icons/icons.svg"}}},4:function(e,t){e.exports='<div class="m-geosearch-content">\n   {{#each features}}\n   <div id="{{solrid}}" class="result">\n      {{#each attributes}}\n      <table>\n         <tr>\n            <td class="key">{{key}}</td>\n            <td class="value{{#oneword value}} m-wordbreak{{/oneword}}">{{{value}}}</td>\n         </tr>\n      </table>\n      {{/each}}\n   </div>\n   <div class="m-separator"></div>\n   {{/each}}\n</div>'},5:function(e,t){e.exports='<div class="m-control m-geosearch-container">\n  \x3c!-- search panel --\x3e\n  <div class="search-panel">\n    <input type="text" id="m-geosearch-search-input" placeholder="Buscar" class="m-input-search" />\n    <button id="m-geosearch-search-btn" class="g-cartografia-zoom m-search-btn" title="Buscar"></button>\n    <button id="m-geosearch-help-btn" class="g-cartografia-ayuda m-help-btn" title="Ayuda"></button>\n    <button id="m-geosearch-clear-btn" class="g-cartografia-cancelar m-clear-btn" title="Limpiar búsqueda"></button>\n  </div>\n  \x3c!-- results panel --\x3e\n  <div class="results-panel" id="m-geosearch-results">\n    <div id="m-searching-result" class="m-searching-result g-cartografia-spinner"></div>\n  </div>\n</div>'},54:function(e,t,n){},6:function(e,t){e.exports='<div class="m-geosearch-help">\n  {{#eq entities.length 0}}\n    <div class="entity">\n      <p>El servicio no tiene ayuda configurada</p>\n      <button id="m-geosearch-closeHelp-btn" class="g-cartografia-cancelar" title="Cerrar ayuda"></button>\n    </div>\n  {{/eq}}\n  {{#each entities}}\n    <div class="entity">\n      <button id="m-geosearch-closeHelp-btn" class="g-cartografia-cancelar m-clear-btn" title="Cerrar ayuda"></button>\n      <div class="name">{{entity}}</div>\n      <div class="info">{{info}}</div>\n      <ul class="keywords">\n        {{#each keywords}}\n          <li>{{this}}</li>\n        {{/each}}\n      </ul>\n      <div class="example">\n        <code>{{example}}</code>\n      </div>\n    </div>\n  {{/each}}\n</div>'},78:function(e,t,n){"use strict";n.r(t);var r=n(2),o=(n(54),n(20));function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function a(e,t){return!t||"object"!==s(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function i(e){return(i=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var c=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=a(this,i(t).call(this))).map_=null,e.control_=null,e.panel_=null,e.name=t.NAME,e.url_=M.config.GEOSEARCH_URL,M.utils.isNullOrEmpty(n.url)||(e.url_=n.url),e.core_=M.config.GEOSEARCH_CORE,M.utils.isNullOrEmpty(n.core)||(e.core_=n.core),e.handler_=M.config.GEOSEARCH_HANDLER,M.utils.isNullOrEmpty(n.handler)||(e.handler_=n.handler),e.searchParameters_=n.params||{},e.showHelp_=n.showHelp,e.metadata_=o.metadata,e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}(t,M.Plugin),function(e,t,n){t&&l(e.prototype,t),n&&l(e,n)}(t,[{key:"addTo",value:function(e){this.map_=e,e.areasContainer.getElementsByClassName("m-top m-right")[0].classList.add("top-extra"),this.control_=new r.a(this.url_,this.core_,this.handler_,this.searchParameters_,this.showHelp_),this.control_.on(M.evt.ADD_TO_MAP,this.onLoadCallback_,this),this.panel_=new M.ui.Panel("geosearch",{collapsible:!0,className:"m-geosearch",collapsedButtonClass:"g-cartografia-zoom",position:M.ui.position.TL,tooltip:"Geobúsquedas"}),this.panel_.addControls(this.control_),this.map_.addPanels(this.panel_)}},{key:"getInput",value:function(){var e=null;return M.utils.isNullOrEmpty(this.control_)||(e=this.control_.getInput()),e}},{key:"destroy",value:function(){this.map_.removeControls([this.control_]),this.map_=null,this.control_=null,this.panel_=null,this.url_=null,this.core_=null,this.handler_=null,this.searchParameters_=null}},{key:"getControls",value:function(){var e=[];return e.push(this.control_),e}},{key:"equals",value:function(e){return e instanceof t}},{key:"getAPIRest",value:function(){return"geosearch=".concat(this.url_,"*").concat(this.core_,"*").concat(this.handler_)}},{key:"getMetadata",value:function(){return this.metadata_}}]),t}();c.NAME="geosearch",null==window.M.plugin&&(window.M.plugin={}),window.M.plugin.Geosearch=c}});