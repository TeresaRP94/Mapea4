!function(e){var t={};function n(i){if(t[i])return t[i].exports;var r=t[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(i,r,function(t){return e[t]}.bind(null,r));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=76)}({37:function(e,t){e.exports='<div class="m-control m-printer-container">\n   \x3c!-- TITLE --\x3e\n   <div class="title">Impresión del mapa</div>\n   \x3c!-- FORM --\x3e\n   <div class="form">\n      \x3c!-- title --\x3e\n      <div class="title">\n         <input type="text" placeholder="Título">\n      </div>\n      \x3c!-- description --\x3e\n      <div class="description">\n         <textarea placeholder="Descripción"></textarea>\n      </div>\n      \x3c!-- layout --\x3e\n      <div class="layout">\n         <label>Plantilla </label>\n         <select>\n            {{#each layouts}}\n            <option value="{{name}}" {{#if default}} selected{{/if}}>{{name}}</option>\n            {{/each}}\n         </select>\n      </div>\n      \x3c!-- DPI --\x3e\n      <div class="dpi">\n         <label>DPI </label>\n         <select>\n            {{#each dpis}}\n            <option value="{{value}}" {{#if default}} selected{{/if}}>{{name}}</option>\n            {{/each}}\n         </select>\n      </div>\n      \x3c!-- format --\x3e\n      <div class="format">\n         <label>Formato </label>\n         <select>\n            {{#each outputFormats}}\n            <option value="{{name}}" {{#if default}} selected{{/if}}>{{name}}</option>\n            {{/each}}\n         </select>\n      </div>\n      \x3c!-- force scale --\x3e\n      <div class="forcescale">\n         <label>Forzar escala </label>\n         <input type="checkbox" {{#if forceScale}} checked{{/if}}>\n      </div>\n   </div>\n   \x3c!-- buttons --\x3e\n   <div class="button">\n      <button class="print"><i class="g-cartografia-impresora"></i> Imprimir</button>\n       <button class="remove"><i class="g-cartografia-papelera"></i> Borrar</button>\n   </div>\n   \x3c!-- queue --\x3e\n   <div class="queue">\n      <div class="title">Descargar</div>\n      <ul class="queue-container"></ul>\n   </div>\n   \x3c!-- minimize button --\x3e\n   <div class="minimize" title="Minimizar el control de impresión"></div>\n</div>'},38:function(e){e.exports={url:{name:"printer",separator:"*"},constructor:"M.plugin.Printer",parameters:[{type:"object",properties:[{type:"simple",name:"url",position:0},{type:"object",name:"params",properties:[{type:"object",name:"layout",properties:[{type:"simple",name:"outputFilename",value:"mapea_${yyyy-MM-dd_hhmmss}"}]},{type:"object",name:"pages",properties:[{type:"simple",name:"clientLogo",value:"http://www.juntadeandalucia.es/economiayhacienda/images/plantilla/logo_cabecera.gif"},{type:"simple",name:"creditos",value:"Impresión generada a través de Mapea"}]}]}]},{type:"object",properties:[{type:"object",name:"options",properties:[{type:"simple",name:"legend",value:"true"}]}]}],files:{ol:{scripts:["printer-2.0.0.ol.min.js"],styles:["printer-2.0.0.min.css"]}},metadata:{name:"Printer",description:"Tool for printing maps.",text:"",version:"2.0.0",date:"11/10/2019",author:"Junta de Andalucía",org:"Junta de Andalucía",tags:"mapea,plugin",icon:"./facade/assets/icons/icons.svg"}}},62:function(e,t,n){},76:function(e,t,n){"use strict";function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function o(e,t){return!t||"object"!==i(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function a(e,t){return(a=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}n.r(t);var s=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=o(this,l(t).call(this))).facadeMap_=null,e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&a(e,t)}(t,M.impl.Control),function(e,t,n){t&&r(e.prototype,t),n&&r(e,n)}(t,[{key:"addTo",value:function(e,t){this.facadeMap_=e,ol.control.Control.call(this,{element:t,target:null}),e.getMapImpl().addControl(this)}},{key:"encodeLayer",value:function(e){var t=this;return new Promise(function(n,i){e.type===M.layer.type.WMC||(e.type===M.layer.type.KML?n(t.encodeKML(e)):e.type===M.layer.type.WMS?n(t.encodeWMS(e)):e.type===M.layer.type.WFS?n(t.encodeWFS(e)):e.type===M.layer.type.GeoJSON?n(t.encodeWFS(e)):e.type===M.layer.type.WMTS?t.encodeWMTS(e).then(function(e){n(e)}):e.type===M.layer.type.MBtiles||(e.type===M.layer.type.OSM?n(t.encodeOSM(e)):e.type===M.layer.type.Mapbox?n(t.encodeMapbox(e)):(M.utils.isNullOrEmpty(e.type)&&M.layer.Vector,n(t.encodeWFS(e)))))})}},{key:"encodeLegend",value:function(e){var t=null;if(e.displayInLayerSwitcher){t={name:e.name,classes:[]};var n=new RegExp(".*".concat(M.Layer.LEGEND_DEFAULT,"$")),i=new RegExp(".*".concat(M.Layer.LEGEND_ERROR,"$")),r=e.getLegendURL();M.utils.isNullOrEmpty(r)||n.test(r)||i.test(r)||(t.classes[0]={name:"",icons:[e.getLegendURL()]},e instanceof M.layer.Vector&&delete t.classes[0].icons)}return t}},{key:"encodeKML",value:function(e){var t=e.getImpl().getOL3Layer(),n=t.getSource().getFeatures(),i=e.name,r=t.getOpacity(),o=new ol.format.GeoJSON,l=this.facadeMap_.getBbox();l=[l.x.min,l.y.min,l.x.max,l.y.max];var a=this.facadeMap_.getMapImpl().getView().getResolution(),s=[],u={},c={},p=1;return n.forEach(function(e){var t=e.getGeometry(),n=e.get("styleUrl");M.utils.isNullOrEmpty(n)||(n=n.replace("#",""));var i=e.getStyle();if(!M.utils.isNullOrEmpty(i)){var r=i(e,a)[0];if(!M.utils.isNullOrEmpty(r)){var f=r.getImage(),y=f.getImageSize();M.utils.isNullOrEmpty(y)&&(y=[64,64]);var m=r.getStroke(),g={id:n,externalGraphic:f.getSrc(),graphicHeight:y[0],graphicWidth:y[1],graphicOpacity:f.getOpacity(),strokeWidth:m.getWidth()},d=r.getText&&r.getText();if(M.utils.isNullOrEmpty(d)||(g=Object.assign(g,{label:M.utils.isNullOrEmpty(d.getText())?e.get("name"):d.getText(),fontColor:M.utils.isNullOrEmpty(d.getFill())?"":M.utils.rgbToHex(M.utils.isArray(d.getFill().getColor())?"rgba(".concat(d.getFill().getColor().toString(),")"):d.getFill().getColor()),fontSize:"11px",fontFamily:"Helvetica, sans-serif",fontWeight:"bold",labelAlign:d.getTextAlign(),labelXOffset:d.getOffsetX(),labelYOffset:d.getOffsetY(),labelOutlineColor:M.utils.isNullOrEmpty(d.getStroke())?"":M.utils.rgbToHex(M.utils.isArray(d.getStroke().getColor())?"rgba(".concat(d.getStroke().getColor().toString(),")"):d.getStroke().getColor()),labelOutlineWidth:M.utils.isNullOrEmpty(d.getStroke())?"":d.getStroke().getWidth()})),!M.utils.isNullOrEmpty(t)&&t.intersectsExtent(l)){var h=JSON.stringify(g),v=c[h];M.utils.isUndefined(v)&&(v=p,c[h]=v,u[v]=g,p+=1);var _=o.writeFeatureObject(e);_.properties={_gx_style:v},s.push(_)}}}},this),{type:"Vector",styles:u,styleProperty:"_gx_style",geoJson:{type:"FeatureCollection",features:s},name:i,opacity:r}}},{key:"encodeWMS",value:function(e){var t=null,n=e.getImpl().getOL3Layer(),i=e.url,r=n.getOpacity(),o=e.getImpl().tiled,l=n.getSource().getParams(),a=[l.LAYERS],s=l.FORMAT,u=[l.STYLES];t={baseURL:i,opacity:r,singleTile:!o,type:"WMS",layers:a.join(",").split(","),format:s||"image/jpeg",styles:u.join(",").split(",")},e._updateNoCache();var c=e.getNoCacheName(),p=e.getNoCacheUrl();return M.utils.isNullOrEmpty(c)||M.utils.isNullOrEmpty(p)||(t.layers=[c],t.baseURL=p),t.customParams={},Object.keys(l).forEach(function(e){-1!=="iswmc,transparent".indexOf(e.toLowerCase())&&(t.customParams[e]=l[e])}),t}},{key:"encodeWFS",value:function(e){var t=this,n=null,i=!0;if(e.getStyle()instanceof M.style.Chart?i=!1:e.getStyle()instanceof M.style.Cluster&&e.getStyle().getOldStyle()instanceof M.style.Chart&&(i=!1),i){var r=this.facadeMap_.getProjection(),o=e.getImpl().getOL3Layer(),l=o.getSource().getFeatures(),a=e.name,s=o.getOpacity(),u=o.getStyle(),c=new ol.format.GeoJSON,p=this.facadeMap_.getBbox();p=[p.x.min,p.y.min,p.x.max,p.y.max];var f=this.facadeMap_.getMapImpl().getView().getResolution(),y=[],m={},g={},d=1;l.forEach(function(e){var n,i=e.getGeometry(),o=e.getStyle();if(M.utils.isNullOrEmpty(o)?M.utils.isNullOrEmpty(u)||(n=u):n=o,n instanceof Function&&(n=n.call(n,e,f)),n instanceof Array&&(n=n.length>1&&!M.utils.isNullOrEmpty(n[1].getImage())&&n[1].getImage().getSrc?n[1]:n[0]),!M.utils.isNullOrEmpty(n)){var l=n.getImage(),a=M.utils.isNullOrEmpty(l)?[0,0]:l.getImageSize()||[24,24],s=n.getText();M.utils.isNullOrEmpty(s)&&!M.utils.isNullOrEmpty(n.textPath)&&(s=n.textPath);var h=M.utils.isNullOrEmpty(l)?n.getStroke():l.getStroke&&l.getStroke(),v=M.utils.isNullOrEmpty(l)?n.getFill():l.getFill&&l.getFill(),_={fillColor:M.utils.isNullOrEmpty(v)?"#000000":M.utils.rgbaToHex(v.getColor()),fillOpacity:M.utils.isNullOrEmpty(v)?1:M.utils.getOpacityFromRgba(v.getColor()),strokeColor:M.utils.isNullOrEmpty(h)?"#000000":M.utils.rgbaToHex(h.getColor()),strokeOpacity:M.utils.isNullOrEmpty(h)?0:M.utils.getOpacityFromRgba(h.getColor()),strokeWidth:M.utils.isNullOrEmpty(h)?0:h.getWidth&&h.getWidth(),pointRadius:M.utils.isNullOrEmpty(l)?"":l.getRadius&&l.getRadius(),externalGraphic:M.utils.isNullOrEmpty(l)?"":l.getSrc&&l.getSrc(),graphicHeight:a[0],graphicWidth:a[1]};if(!M.utils.isNullOrEmpty(s)){var b=s.getTextAlign(),O=s.getTextBaseline(),E="";M.utils.isNullOrEmpty(b)||(b=b===M.style.align.LEFT?"l":b===M.style.align.RIGHT?"r":b===M.style.align.CENTER?"c":""),M.utils.isNullOrEmpty(O)||(O=O===M.style.baseline.BOTTOM?"b":O===M.style.baseline.MIDDLE?"m":O===M.style.baseline.TOP?"t":""),M.utils.isNullOrEmpty(b)||M.utils.isNullOrEmpty(O)||(E=b.concat(O));var S=s.getFont(),x=!M.utils.isNullOrEmpty(S)&&S.indexOf("bold")>-1?"bold":"normal",L="11px";if(!M.utils.isNullOrEmpty(S)){var N=S.substr(0,S.indexOf("px"));if(!M.utils.isNullOrEmpty(N)){var T=N.lastIndexOf(" ");L=T>-1?N.substr(T,N.length).trim().concat("px"):N.concat("px")}}_=Object.assign(_,{label:s.getText(),fontColor:M.utils.isNullOrEmpty(s.getFill())?"#000000":M.utils.rgbToHex(s.getFill().getColor()),fontSize:L,fontFamily:"Helvetica, sans-serif",fontStyle:"normal",fontWeight:x,labelXOffset:s.getOffsetX(),labelYOffset:s.getOffsetY(),fillColor:_.fillColor||"#FF0000",fillOpacity:_.fillOpacity||1,labelOutlineColor:M.utils.isNullOrEmpty(s.getStroke())?"":M.utils.rgbToHex(s.getStroke().getColor()||"#FF0000"),labelOutlineWidth:M.utils.isNullOrEmpty(s.getStroke())?"":s.getStroke().getWidth(),labelAlign:E})}if(!M.utils.isNullOrEmpty(i)&&i.intersectsExtent(p)){var P,k=JSON.stringify(_),C=g[k];M.utils.isUndefined(C)&&(C=d,g[k]=C,m[C]=_,d+=1),(P="EPSG:3857"!==r.code&&t.facadeMap_.getLayers().some(function(e){return e.type===M.layer.type.OSM||e.type===M.layer.type.Mapbox})?c.writeFeatureObject(e,{featureProjection:r.code,dataProjection:"EPSG:3857"}):c.writeFeatureObject(e)).properties={_gx_style:C},y.push(P)}}},this),n={type:"Vector",styles:m,styleProperty:"_gx_style",geoJson:{type:"FeatureCollection",features:y},name:a,opacity:s}}return n}},{key:"encodeWMTS",value:function(e){var t=this.facadeMap_.getZoom(),n=e.getImpl(),i=n.getOL3Layer(),r=i.getSource(),o=r.getTileGrid(),l=e.url,a=e.name,s=i.getOpacity(),u=r.getRequestEncoding(),c=n.tiled,p=i.getExtent(),f={},y=r.getMatrixSet(),m=o.getTileSize(t),g=o.getResolutions();return e.getImpl().getCapabilities().then(function(e){var t=e.Contents.TileMatrixSet.filter(function(e){return e.Identifier===y})[0];return{baseURL:l,opacity:s,singleTile:!c,type:"WMTS",layer:a,requestEncoding:u,tileSize:m,style:"deafult",rotation:0,imageFormat:"image/png",dimensionParams:{},dimensions:[],params:f,version:"1.0.0",maxExtent:p,matrixSet:y,matrixIds:t.TileMatrix.map(function(e,t){return{identifier:e.Identifier,matrixSize:[e.MatrixHeight,e.MatrixWidth],scaleDenominator:e.ScaleDenominator,tileSize:[e.TileWidth,e.TileHeight],topLeftCorner:e.TopLeftCorner}}),resolutions:g}})}},{key:"encodeOSM",value:function(e){var t=e.getImpl(),n=t.getOL3Layer(),i=n.getSource().getTileGrid(),r=e.url||"http://tile.openstreetmap.org/",o=e.name,l=n.getOpacity(),a=t.tiled,s=i.getExtent(),u=i.getTileSize();return{baseURL:r,opacity:l,singleTile:!a,layer:o,maxExtent:s,tileSize:[u,u],resolutions:i.getResolutions(),type:"OSM",extension:"png"}}},{key:"encodeMapbox",value:function(e){var t=e.getImpl().getOL3Layer(),n=t.getSource().getTileGrid(),i=M.utils.concatUrlPaths([M.config.MAPBOX_URL,e.name]),r=t.getOpacity(),o=n.getExtent(),l=n.getTileSize(),a=n.getResolutions(),s={};return s[M.config.MAPBOX_TOKEN_NAME]=M.config.MAPBOX_TOKEN_VALUE,{opacity:r,baseURL:i,customParams:s,maxExtent:o,tileSize:[l,l],resolutions:a,extension:M.config.MAPBOX_EXTENSION,type:"xyz",path_format:"/${z}/${x}/${y}.png"}}},{key:"destroy",value:function(){this.facadeMap_.getMapImpl().removeControl(this),this.facadeMap_=null}}]),t}(),u=n(37),c=n.n(u);function p(e){return(p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function f(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function y(e,t){return!t||"object"!==p(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function m(e){return(m=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function g(e,t){return(g=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var d=function(e){function t(e,n,i,r){var o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var l=new s;return o=y(this,m(t).call(this,l,t.NAME)),M.utils.isUndefined(s)&&M.exception("La implementación usada no puede crear controles Printer"),M.utils.isUndefined(s.prototype.encodeLayer)&&M.exception("La implementación usada no posee el método encodeLayer"),M.utils.isUndefined(s.prototype.encodeLegend)&&M.exception("La implementación usada no posee el método encodeLegend"),o.url_=e,o.inputTitle_=null,o.areaDescription_=null,o.layout_=null,o.format_=null,o.dpi_=null,o.forceScale_=null,o.params_=n||{},o.queueContainer_=null,o.capabilitiesPromise_=null,o.options_=i||{},M.utils.isNullOrEmpty(o.options_.layout)&&(o.options_.layout=M.config.geoprint.TEMPLATE),M.utils.isNullOrEmpty(o.options_.dpi)&&(o.options_.dpi=M.config.geoprint.DPI),M.utils.isNullOrEmpty(o.options_.format)&&(o.options_.format=M.config.geoprint.FORMAT),M.utils.isNullOrEmpty(o.options_.forceScale)&&(o.options_.forceScale=M.config.geoprint.FORCE_SCALE),M.utils.isNullOrEmpty(o.options_.legend)&&(o.options_.legend=M.config.geoprint.LEGEND),o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&g(e,t)}(t,M.Control),function(e,t,n){t&&f(e.prototype,t),n&&f(e,n)}(t,[{key:"createView",value:function(e){var t=this;return new Promise(function(e,n){t.getCapabilities().then(function(n){var i,r=n,o=0;for(o=0,i=r.layouts.length;o<i;o+=1){var l=r.layouts[o];if(l.name===t.options_.layout){l.default=!0;break}}for(o=0,i=r.dpis.length;o<i;o+=1){var a=r.dpis[o];if(parseInt(a.value,10)===t.options_.dpi){a.default=!0;break}}for(o=0,i=r.outputFormats.length;o<i;o+=1){var s=r.outputFormats[o];if(s.name===t.options_.format){s.default=!0;break}}r.forceScale=t.options_.forceScale;var u=M.template.compileSync(c.a,{jsonp:!0,vars:r});t.addEvents(u),e(u)})})}},{key:"addEvents",value:function(e){var t=this;this.element_=e,this.inputTitle_=this.element_.querySelector(".form div.title > input"),this.areaDescription_=this.element_.querySelector(".form div.description > textarea");var n=this.element_.querySelector(".form div.layout > select");n.addEventListener("change",function(e){var i=n.value;t.setLayout({value:i,name:i})});var i=n.value;this.setLayout({value:i,name:i});var r=this.element_.querySelector(".form div.dpi > select");r.addEventListener("change",function(e){var n=r.value;t.setDpi({value:n,name:n})});var o=r.value;this.setDpi({value:o,name:o});var l=this.element_.querySelector(".form div.format > select");l.addEventListener("change",function(e){t.setFormat(l.value)}),this.setFormat(l.value);var a=this.element_.querySelector(".form div.forcescale > input");a.addEventListener("click",function(e){t.setForceScale(!0===a.checked)}),this.setForceScale(!0===a.checked),this.element_.querySelector(".button > button.print").addEventListener("click",this.printClick_.bind(this)),this.element_.querySelector(".button > button.remove").addEventListener("click",function(e){e.preventDefault(),t.inputTitle_.value="",t.areaDescription_.value="",n.value=t.options_.layout,r.value=t.options_.dpi,l.value=t.options_.format,a.checked=t.options_.forceScale;var i=document.createEvent("HTMLEvents");i.initEvent("change");var o=document.createEvent("HTMLEvents");for(o.initEvent("click"),n.dispatchEvent(i),r.dispatchEvent(i),l.dispatchEvent(i),a.dispatchEvent(o),Array.prototype.forEach.apply(t.queueContainer_.children,[function(e){e.removeEventListener("click",t.dowloadPrint)},t]);t.queueContainer_.fistChild;)t.queueContainer_(t.queueContainer_.firsChild)}),this.queueContainer_=this.element_.querySelector(".queue > ul.queue-container"),M.utils.enableTouchScroll(this.queueContainer_)}},{key:"setLayout",value:function(e){this.layout_=e}},{key:"setFormat",value:function(e){this.format_=e}},{key:"setDpi",value:function(e){this.dpi_=e}},{key:"setForceScale",value:function(e){this.forceScale_=e}},{key:"printClick_",value:function(e){var n=this;e.preventDefault(),this.getCapabilities().then(function(e){n.getPrintData().then(function(i){var r=M.utils.addParameters(e.createURL,"mapeaop=geoprint"),o=n.createQueueElement();n.queueContainer_.appendChild(o),o.classList.add(t.LOADING_CLASS),M.remote.post(r,i).then(function(e){var i=e;if(o.classList.remove(t.LOADING_CLASS),!0!==i.error){var r;try{r=(i=JSON.parse(i.text)).getURL}catch(e){M.exception(e)}o.setAttribute(t.DOWNLOAD_ATTR_NAME,r),o.addEventListener("click",n.dowloadPrint)}else M.dialog.error("Se ha producido un error en la impresión")})})})}},{key:"getCapabilities",value:function(){var e=this;return M.utils.isNullOrEmpty(this.capabilitiesPromise_)&&(this.capabilitiesPromise_=new Promise(function(t,n){var i=M.utils.concatUrlPaths([e.url_,"info.json"]);M.remote.get(i).then(function(e){var n={};try{n=JSON.parse(e.text)}catch(e){M.exception(e)}t(n)})})),this.capabilitiesPromise_}},{key:"getPrintData",value:function(){var e=this,t=this.inputTitle_.value,n=this.areaDescription_.value,i=this.map_.getProjection(),r=this.layout_.name,o=this.dpi_.value,l=this.format_,a=M.utils.extend({units:i.units,srs:i.code,layout:r,dpi:o,outputFormat:l},this.params_.layout);return this.encodeLayers().then(function(r){return a.layers=r,a.pages=e.encodePages(t,n),!0===e.options_.legend&&(a.legends=e.encodeLegends()),"EPSG:3857"!==i.code&&e.map_.getLayers().some(function(e){return e.type===M.layer.type.OSM||e.type===M.layer.type.Mapbox})&&(a.srs="EPSG:3857"),a})}},{key:"encodeLayers",value:function(){var e=this,t=this.map_.getLayers().filter(function(e){return!0===e.isVisible()&&!0===e.inRange()&&"cluster_cover"!==e.name}),n=t.length;return new Promise(function(i,r){var o=[];t.forEach(function(t){e.getImpl().encodeLayer(t).then(function(e){M.utils.isNullOrEmpty(e)||o.push(e),0===(n-=1)&&i(o)})})})}},{key:"encodePages",value:function(e,t){var n=this,i=[],r=this.map_.getProjection();return M.utils.isArray(this.params_.pages)||(this.params_.pages=[this.params_.pages]),this.params_.pages.forEach(function(o){var l=M.utils.extend({title:e,printTitle:e,printDescription:t,infoSRS:"\n ".concat(n.map_.getProjection().code)},o);if(!1===n.forceScale_){var a=n.map_.getBbox();l.bbox=[a.x.min,a.y.min,a.x.max,a.y.max],"EPSG:3857"!==r.code&&n.map_.getLayers().some(function(e){return e.type===M.layer.type.OSM||e.type===M.layer.type.Mapbox})&&(l.bbox=ol.proj.transformExtent(l.bbox,r.code,"EPSG:3857"))}else if(!0===n.forceScale_){var s=n.map_.getCenter();l.center=[s.x,s.y],l.scale=n.map_.getScale()}l.rotation=0,i.push(l)},this),i}},{key:"encodeLegends",value:function(){var e=this,t=[];return this.map_.getLayers().forEach(function(n){if(!0===n.isVisible()&&!0===n.inRange()){var i=e.getImpl().encodeLegend(n);null!==i&&t.push(i)}},this),t}},{key:"createQueueElement",value:function(){var e=document.createElement("li"),n=this.inputTitle_.value;return M.utils.isNullOrEmpty(n)&&(n=t.NO_TITLE),e.innerHTML=n,e}},{key:"dowloadPrint",value:function(e){e.preventDefault();var n=this.getAttribute(t.DOWNLOAD_ATTR_NAME);M.utils.isNullOrEmpty(n)||window.open(n,"_blank")}},{key:"equals",value:function(e){var n=!1;return e instanceof t&&(n=this.name===e.name),n}}]),t}();d.NAME="printercontrol",d.TEMPLATE="printer.html",d.LOADING_CLASS="printing",d.DOWNLOAD_ATTR_NAME="data-donwload-url-print",d.NO_TITLE="(Sin título)";n(62);var h=n(38);function v(e){return(v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function b(e,t){return!t||"object"!==v(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function O(e){return(O=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function E(e,t){return(E=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var S=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=b(this,O(t).call(this,null))).map_=null,e.control_=null,e.panel_=null,e.name=t.NAME,e.url_=M.config.geoprint.URL,M.utils.isNullOrEmpty(n.url)||(e.url_=n.url),e.params_={},M.utils.isNullOrEmpty(n.params)||(e.params_=n.params),e.options_={},M.utils.isNullOrEmpty(n.options)||(e.options_=n.options),e.metadata_=h.metadata,e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&E(e,t)}(t,M.Plugin),function(e,t,n){t&&_(e.prototype,t),n&&_(e,n)}(t,[{key:"addTo",value:function(e){var t=this;this.map_=e,this.control_=new d(this.url_,this.params_,this.options_),this.panel_=new M.ui.Panel("printer",{collapsible:!0,className:"m-printer",collapsedButtonClass:"g-cartografia-impresora",position:M.ui.position.TR,tooltip:"Impresión del mapa"}),this.panel_.on(M.evt.ADDED_TO_MAP,function(e){M.utils.enableTouchScroll(e)}),this.panel_.addControls(this.control_),this.map_.addPanels(this.panel_),this.control_.on(M.evt.ADDED_TO_MAP,function(){t.fire(M.evt.ADDED_TO_MAP)})}},{key:"getControls",value:function(){var e=[];return e.push(this.control_),e}},{key:"destroy",value:function(){this.map_.removeControls([this.control_]),this.map_=null,this.control_=null,this.panel_=null,this.url_=null,this.params_=null,this.options_=null,this.name=null}},{key:"equals",value:function(e){return e instanceof t}},{key:"getAPIRest",value:function(){return"printer=".concat(this.url_)}},{key:"getMetadata",value:function(){return this.metadata_}}]),t}();S.NAME="printer",null==window.M.plugin&&(window.M.plugin={}),window.M.plugin.Printer=S}});