!function(t){var e={};function n(i){if(e[i])return e[i].exports;var o=e[i]={i:i,l:!1,exports:{}};return t[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(i,o,function(e){return t[e]}.bind(null,o));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=71)}({12:function(t,e,n){var i,o;
/*!
 * getSize v2.0.3
 * measure size of elements
 * MIT license
 */window,void 0===(o="function"==typeof(i=function(){"use strict";function t(t){var e=parseFloat(t),n=-1==t.indexOf("%")&&!isNaN(e);return n&&e}var e="undefined"==typeof console?function(){}:function(t){console.error(t)},n=["paddingLeft","paddingRight","paddingTop","paddingBottom","marginLeft","marginRight","marginTop","marginBottom","borderLeftWidth","borderRightWidth","borderTopWidth","borderBottomWidth"],i=n.length;function o(t){var n=getComputedStyle(t);return n||e("Style returned "+n+". Are you running this code in a hidden iframe on Firefox? See https://bit.ly/getsizebug1"),n}var r,s=!1;function a(e){if(function(){if(!s){s=!0;var e=document.createElement("div");e.style.width="200px",e.style.padding="1px 2px 3px 4px",e.style.borderStyle="solid",e.style.borderWidth="1px 2px 3px 4px",e.style.boxSizing="border-box";var n=document.body||document.documentElement;n.appendChild(e);var i=o(e);r=200==Math.round(t(i.width)),a.isBoxSizeOuter=r,n.removeChild(e)}}(),"string"==typeof e&&(e=document.querySelector(e)),e&&"object"==typeof e&&e.nodeType){var l=o(e);if("none"==l.display)return function(){for(var t={width:0,height:0,innerWidth:0,innerHeight:0,outerWidth:0,outerHeight:0},e=0;e<i;e++){var o=n[e];t[o]=0}return t}();var u={};u.width=e.offsetWidth,u.height=e.offsetHeight;for(var c=u.isBorderBox="border-box"==l.boxSizing,h=0;h<i;h++){var p=n[h],d=l[p],f=parseFloat(d);u[p]=isNaN(f)?0:f}var m=u.paddingLeft+u.paddingRight,y=u.paddingTop+u.paddingBottom,g=u.marginLeft+u.marginRight,v=u.marginTop+u.marginBottom,_=u.borderLeftWidth+u.borderRightWidth,b=u.borderTopWidth+u.borderBottomWidth,E=c&&r,w=t(l.width);!1!==w&&(u.width=w+(E?0:m+_));var M=t(l.height);return!1!==M&&(u.height=M+(E?0:y+b)),u.innerWidth=u.width-(m+_),u.innerHeight=u.height-(y+b),u.outerWidth=u.width+g,u.outerHeight=u.height+v,u}}return a})?i.call(e,n,e,t):i)||(t.exports=o)},13:function(t,e,n){var i,o;
/*!
 * Unidragger v2.3.0
 * Draggable base class
 * MIT license
 */
/*!
 * Unidragger v2.3.0
 * Draggable base class
 * MIT license
 */
!function(r,s){i=[n(14)],void 0===(o=function(t){return function(t,e){"use strict";function n(){}var i=n.prototype=Object.create(e.prototype);i.bindHandles=function(){this._bindHandles(!0)},i.unbindHandles=function(){this._bindHandles(!1)},i._bindHandles=function(e){for(var n=(e=void 0===e||e)?"addEventListener":"removeEventListener",i=e?this._touchActionValue:"",o=0;o<this.handles.length;o++){var r=this.handles[o];this._bindStartEvent(r,e),r[n]("click",this),t.PointerEvent&&(r.style.touchAction=i)}},i._touchActionValue="none",i.pointerDown=function(t,e){var n=this.okayPointerDown(t);n&&(this.pointerDownPointer=e,t.preventDefault(),this.pointerDownBlur(),this._bindPostStartEvents(t),this.emitEvent("pointerDown",[t,e]))};var o={TEXTAREA:!0,INPUT:!0,SELECT:!0,OPTION:!0},r={radio:!0,checkbox:!0,button:!0,submit:!0,image:!0,file:!0};return i.okayPointerDown=function(t){var e=o[t.target.nodeName],n=r[t.target.type],i=!e||n;return i||this._pointerReset(),i},i.pointerDownBlur=function(){var t=document.activeElement;t&&t.blur&&t!=document.body&&t.blur()},i.pointerMove=function(t,e){var n=this._dragPointerMove(t,e);this.emitEvent("pointerMove",[t,e,n]),this._dragMove(t,e,n)},i._dragPointerMove=function(t,e){var n={x:e.pageX-this.pointerDownPointer.pageX,y:e.pageY-this.pointerDownPointer.pageY};return!this.isDragging&&this.hasDragStarted(n)&&this._dragStart(t,e),n},i.hasDragStarted=function(t){return Math.abs(t.x)>3||Math.abs(t.y)>3},i.pointerUp=function(t,e){this.emitEvent("pointerUp",[t,e]),this._dragPointerUp(t,e)},i._dragPointerUp=function(t,e){this.isDragging?this._dragEnd(t,e):this._staticClick(t,e)},i._dragStart=function(t,e){this.isDragging=!0,this.isPreventingClicks=!0,this.dragStart(t,e)},i.dragStart=function(t,e){this.emitEvent("dragStart",[t,e])},i._dragMove=function(t,e,n){this.isDragging&&this.dragMove(t,e,n)},i.dragMove=function(t,e,n){t.preventDefault(),this.emitEvent("dragMove",[t,e,n])},i._dragEnd=function(t,e){this.isDragging=!1,setTimeout(function(){delete this.isPreventingClicks}.bind(this)),this.dragEnd(t,e)},i.dragEnd=function(t,e){this.emitEvent("dragEnd",[t,e])},i.onclick=function(t){this.isPreventingClicks&&t.preventDefault()},i._staticClick=function(t,e){this.isIgnoringMouseUp&&"mouseup"==t.type||(this.staticClick(t,e),"mouseup"!=t.type&&(this.isIgnoringMouseUp=!0,setTimeout(function(){delete this.isIgnoringMouseUp}.bind(this),400)))},i.staticClick=function(t,e){this.emitEvent("staticClick",[t,e])},n.getPointerPoint=e.getPointerPoint,n}(r,t)}.apply(e,i))||(t.exports=o)}(window)},14:function(t,e,n){var i,o;
/*!
 * Unipointer v2.3.0
 * base class for doing one thing with pointer event
 * MIT license
 */
/*!
 * Unipointer v2.3.0
 * base class for doing one thing with pointer event
 * MIT license
 */
!function(r,s){i=[n(15)],void 0===(o=function(t){return function(t,e){"use strict";function n(){}var i=n.prototype=Object.create(e.prototype);i.bindStartEvent=function(t){this._bindStartEvent(t,!0)},i.unbindStartEvent=function(t){this._bindStartEvent(t,!1)},i._bindStartEvent=function(e,n){var i=(n=void 0===n||n)?"addEventListener":"removeEventListener",o="mousedown";t.PointerEvent?o="pointerdown":"ontouchstart"in t&&(o="touchstart"),e[i](o,this)},i.handleEvent=function(t){var e="on"+t.type;this[e]&&this[e](t)},i.getTouch=function(t){for(var e=0;e<t.length;e++){var n=t[e];if(n.identifier==this.pointerIdentifier)return n}},i.onmousedown=function(t){var e=t.button;e&&0!==e&&1!==e||this._pointerDown(t,t)},i.ontouchstart=function(t){this._pointerDown(t,t.changedTouches[0])},i.onpointerdown=function(t){this._pointerDown(t,t)},i._pointerDown=function(t,e){t.button||this.isPointerDown||(this.isPointerDown=!0,this.pointerIdentifier=void 0!==e.pointerId?e.pointerId:e.identifier,this.pointerDown(t,e))},i.pointerDown=function(t,e){this._bindPostStartEvents(t),this.emitEvent("pointerDown",[t,e])};var o={mousedown:["mousemove","mouseup"],touchstart:["touchmove","touchend","touchcancel"],pointerdown:["pointermove","pointerup","pointercancel"]};return i._bindPostStartEvents=function(e){if(e){var n=o[e.type];n.forEach(function(e){t.addEventListener(e,this)},this),this._boundPointerEvents=n}},i._unbindPostStartEvents=function(){this._boundPointerEvents&&(this._boundPointerEvents.forEach(function(e){t.removeEventListener(e,this)},this),delete this._boundPointerEvents)},i.onmousemove=function(t){this._pointerMove(t,t)},i.onpointermove=function(t){t.pointerId==this.pointerIdentifier&&this._pointerMove(t,t)},i.ontouchmove=function(t){var e=this.getTouch(t.changedTouches);e&&this._pointerMove(t,e)},i._pointerMove=function(t,e){this.pointerMove(t,e)},i.pointerMove=function(t,e){this.emitEvent("pointerMove",[t,e])},i.onmouseup=function(t){this._pointerUp(t,t)},i.onpointerup=function(t){t.pointerId==this.pointerIdentifier&&this._pointerUp(t,t)},i.ontouchend=function(t){var e=this.getTouch(t.changedTouches);e&&this._pointerUp(t,e)},i._pointerUp=function(t,e){this._pointerDone(),this.pointerUp(t,e)},i.pointerUp=function(t,e){this.emitEvent("pointerUp",[t,e])},i._pointerDone=function(){this._pointerReset(),this._unbindPostStartEvents(),this.pointerDone()},i._pointerReset=function(){this.isPointerDown=!1,delete this.pointerIdentifier},i.pointerDone=function(){},i.onpointercancel=function(t){t.pointerId==this.pointerIdentifier&&this._pointerCancel(t,t)},i.ontouchcancel=function(t){var e=this.getTouch(t.changedTouches);e&&this._pointerCancel(t,e)},i._pointerCancel=function(t,e){this._pointerDone(),this.pointerCancel(t,e)},i.pointerCancel=function(t,e){this.emitEvent("pointerCancel",[t,e])},n.getPointerPoint=function(t){return{x:t.pageX,y:t.pageY}},n}(r,t)}.apply(e,i))||(t.exports=o)}(window)},15:function(t,e,n){var i,o;"undefined"!=typeof window&&window,void 0===(o="function"==typeof(i=function(){"use strict";function t(){}var e=t.prototype;return e.on=function(t,e){if(t&&e){var n=this._events=this._events||{},i=n[t]=n[t]||[];return-1==i.indexOf(e)&&i.push(e),this}},e.once=function(t,e){if(t&&e){this.on(t,e);var n=this._onceEvents=this._onceEvents||{};return(n[t]=n[t]||{})[e]=!0,this}},e.off=function(t,e){var n=this._events&&this._events[t];if(n&&n.length){var i=n.indexOf(e);return-1!=i&&n.splice(i,1),this}},e.emitEvent=function(t,e){var n=this._events&&this._events[t];if(n&&n.length){n=n.slice(0),e=e||[];for(var i=this._onceEvents&&this._onceEvents[t],o=0;o<n.length;o++){var r=n[o];i&&i[r]&&(this.off(t,r),delete i[r]),r.apply(this,e)}return this}},e.allOff=function(){delete this._events,delete this._onceEvents},t})?i.call(e,n,e,t):i)||(t.exports=o)},16:function(t,e){t.exports='<div class="results-panels">\n    {{#if partial}}\n        <div class="partial">\n            <p>No se han encontrado resultados para la búsqueda.</p>\n            <p>A continuación se muestran otros resultados que quizás le interesen:...</p>\n        </div>\n    {{/if}}\n    <div class="results" id="m-geosearch-results-scroll">\n        {{#each docs}}\n            <div id="{{solrid}}" class="result">\n                {{#each attributes}}\n                    <table>\n                        <tbody>\n                            <tr>\n                                <td class="key">{{key}}</td>\n                                <td class="value{{#oneword value}} m-wordbreak{{/oneword}}">{{{value}}}</td>\n                            </tr>\n                        </tbody>\n                    </table>\n                {{/each}}\n            </div>\n        {{/each}}\n    </div>\n    {{#eq docs.length 0}}\n        <div class="results">\n            <div class="partial">No se han encontrado resultados para la búsqueda "{{query}}".</div>\n        </div>\n    {{/eq}}\n    <div class="page">\n        <span class="found" id="m-geosearch-page-found">{{docs.length}}</span> de <span class="total">{{total}}</span>\n        <div class="g-cartografia-flecha-arriba"></div>\n    </div>\n</div>'},21:function(t,e){t.exports='<div class="m-geosearch-content">\n   {{#each features}}\n   <div id="{{solrid}}" class="result">\n      {{#each attributes}}\n      <table>\n         <tr>\n            <td class="key">{{key}}</td>\n            <td class="value{{#oneword value}} m-wordbreak{{/oneword}}">{{{value}}}</td>\n         </tr>\n      </table>\n      {{/each}}\n   </div>\n   <div class="m-separator"></div>\n   {{/each}}\n</div>'},22:function(t,e){t.exports='<div class="m-control m-geosearchbycoordinates-container" id="m-geosearchbycoordinates-div" title="Geobúsquedas por geolocalización">\n   <button id="m-geosearchbycoordinates-button" class="g-cartografia-posicion"></button>\n   <button id="m-geosearchbycoordinates-button-list" class="g-cartografia-lista hidden"></button>\n</div>'},23:function(t,e){t.exports='<div class="m-geosearchbycoordinates-results-panel">\n    <div class="title">\n        B&uacute;squeda por localizaci&oacute;n\n        <button class="m-panel-btn"></button>\n    </div>\n    <div class="results" id="m-geosearchbycoordinates-results-scroll">\n        {{#each docs}}\n            <div id="{{solrid}}" class="result">\n                {{#each attributes}}\n                    <table>\n                        <tbody>\n                            <tr>\n                                <td class="key">{{key}}</td>\n                                <td class="value">{{{value}}}</td>\n                            </tr>\n                        </tbody>\n                    </table>\n                {{/each}}\n            </div>\n        {{/each}}\n    </div>\n    <div class="page">\n        <span class="total">{{total}} resultados.</span>\n    </div>\n</div>'},24:function(t,e){t.exports='<div class="m-control m-geosearch-container">\n  \x3c!-- search panel --\x3e\n  <div class="search-panel">\n    <input type="text" id="m-geosearch-search-input" placeholder="Buscar" class="m-input-search" />\n    <button id="m-geosearch-search-btn" class="g-cartografia-zoom m-search-btn" title="Buscar"></button>\n    <button id="m-geosearch-help-btn" class="g-cartografia-ayuda m-help-btn" title="Ayuda"></button>\n    <button id="m-geosearch-clear-btn" class="g-cartografia-cancelar m-clear-btn" title="Limpiar búsqueda"></button>\n  </div>\n  \x3c!-- results panel --\x3e\n  <div class="results-panel" id="m-geosearch-results">\n    <div id="m-searching-result" class="m-searching-result g-cartografia-spinner"></div>\n  </div>\n</div>'},25:function(t,e){t.exports='<div class="m-geosearch-help">\n  {{#eq entities.length 0}}\n    <div class="entity">\n      <p>El servicio no tiene ayuda configurada</p>\n      <button id="m-geosearch-closeHelp-btn" class="g-cartografia-cancelar" title="Cerrar ayuda"></button>\n    </div>\n  {{/eq}}\n  {{#each entities}}\n    <div class="entity">\n      <button id="m-geosearch-closeHelp-btn" class="g-cartografia-cancelar m-clear-btn" title="Cerrar ayuda"></button>\n      <div class="name">{{entity}}</div>\n      <div class="info">{{info}}</div>\n      <ul class="keywords">\n        {{#each keywords}}\n          <li>{{this}}</li>\n        {{/each}}\n      </ul>\n      <div class="example">\n        <code>{{example}}</code>\n      </div>\n    </div>\n  {{/each}}\n</div>'},26:function(t){t.exports={url:{name:"geosearchbycoordinates",separator:"*"},constructor:"M.plugin.GeosearchByCoordinates",parameters:[],files:{ol:{scripts:["geosearchbycoordinates-1.0.0.ol.min.js"],styles:["geosearchbycoordinates-1.0.0.min.css"]}},metadata:{name:"GeosearchByCoordinates",description:"Search for locations within a given radius from a click on a point on the map.",text:"",version:"1.0.0",date:"11/10/2019",author:"Junta de Andalucía",org:"Junta de Andalucía",tags:"mapea,plugin",icon:"./facade/assets/icons/icons.svg"}}},56:function(t,e,n){},71:function(t,e,n){"use strict";n.r(e);n(56);var i=n(8),o=n.n(i),r=n(21),s=n.n(r);function a(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var l=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}return function(t,e,n){e&&a(t.prototype,e),n&&a(t,n)}(t,null,[{key:"init",value:function(){if(!1===t.initialized){t.initialized=!0;var e=document.createElement("img");e.src=M.utils.concatUrlPaths([M.config.THEME_URL,"/img/m-pin-24.svg"]),e.width="24",e.height="24",e.crossOrigin="anonymous";var n=document.createElement("IMG");n.src=M.utils.concatUrlPaths([M.config.THEME_URL,"/img/m-pin-24-new.svg"]),n.width="24",n.height="24",n.crossOrigin="anonymous";var i=document.createElement("IMG");i.src=M.utils.concatUrlPaths([M.config.THEME_URL,"/img/m-pin-24-sel.svg"]),i.width="24",i.height="24",i.crossOrigin="anonymous",t.DEFAULT[M.geom.wkt.type.POINT]=new ol.style.Style({image:new ol.style.Icon({img:e,imgSize:[24,24]})}),t.DEFAULT[M.geom.wkt.type.LINE_STRING]=new ol.style.Style({fill:new ol.style.Fill({color:"#A15BD7"}),stroke:new ol.style.Stroke({color:"#A15BD7",width:2})}),t.DEFAULT[M.geom.wkt.type.POLYGON]=new ol.style.Style({image:new ol.style.Icon({img:e,imgSize:[24,24]})}),t.DEFAULT[M.geom.wkt.type.MULTI_POINT]=t.DEFAULT[M.geom.wkt.type.POINT],t.DEFAULT[M.geom.wkt.type.LINEAR_RING]=t.DEFAULT[M.geom.wkt.type.LINE_STRING],t.DEFAULT[M.geom.wkt.type.MULTI_LINE_STRING]=t.DEFAULT[M.geom.wkt.type.LINE_STRING],t.DEFAULT[M.geom.wkt.type.MULTI_POLYGON]=t.DEFAULT[M.geom.wkt.type.POLYGON],t.DEFAULT[M.geom.wkt.type.CIRCLE]=t.DEFAULT[M.geom.wkt.type.POLYGON],t.DEFAULT[M.geom.wkt.type.GEOMETRY_COLLECTION]=t.DEFAULT[M.geom.wkt.type.POLYGON],t.NEW[M.geom.wkt.type.POINT]=new ol.style.Style({image:new ol.style.Icon({img:n,imgSize:[24,24]})}),t.NEW[M.geom.wkt.type.LINE_STRING]=new ol.style.Style({fill:new ol.style.Fill({color:"#e2951b"}),stroke:new ol.style.Stroke({color:"#e2951b",width:2})}),t.NEW[M.geom.wkt.type.POLYGON]=new ol.style.Style({image:new ol.style.Icon({img:n,imgSize:[24,24]})}),t.NEW[M.geom.wkt.type.MULTI_POINT]=t.NEW[M.geom.wkt.type.POINT],t.NEW[M.geom.wkt.type.LINEAR_RING]=t.NEW[M.geom.wkt.type.LINE_STRING],t.NEW[M.geom.wkt.type.MULTI_LINE_STRING]=t.NEW[M.geom.wkt.type.LINE_STRING],t.NEW[M.geom.wkt.type.MULTI_POLYGON]=t.NEW[M.geom.wkt.type.POLYGON],t.NEW[M.geom.wkt.type.CIRCLE]=t.NEW[M.geom.wkt.type.POLYGON],t.NEW[M.geom.wkt.type.GEOMETRY_COLLECTION]=t.NEW[M.geom.wkt.type.POLYGON],t.SELECTED[M.geom.wkt.type.POINT]=new ol.style.Style({image:new ol.style.Icon({img:i,imgSize:[24,24]})}),t.SELECTED[M.geom.wkt.type.LINE_STRING]=new ol.style.Style({fill:new ol.style.Fill({color:"#fcfcfc"}),stroke:new ol.style.Stroke({color:"#3589d1",width:2})}),t.SELECTED[M.geom.wkt.type.POLYGON]=new ol.style.Style({fill:new ol.style.Fill({color:"rgba(240, 220, 255, 0.2)"}),stroke:new ol.style.Stroke({color:"#a15bd7",width:2})}),t.SELECTED[M.geom.wkt.type.MULTI_POINT]=t.SELECTED[M.geom.wkt.type.POINT],t.SELECTED[M.geom.wkt.type.LINEAR_RING]=t.SELECTED[M.geom.wkt.type.LINE_STRING],t.SELECTED[M.geom.wkt.type.MULTI_LINE_STRING]=t.SELECTED[M.geom.wkt.type.LINE_STRING],t.SELECTED[M.geom.wkt.type.MULTI_POLYGON]=t.SELECTED[M.geom.wkt.type.POLYGON],t.SELECTED[M.geom.wkt.type.CIRCLE]=t.SELECTED[M.geom.wkt.type.POLYGON],t.SELECTED[M.geom.wkt.type.GEOMETRY_COLLECTION]=t.SELECTED[M.geom.wkt.type.POLYGON]}}}]),t}();function u(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}l.DEFAULT={},l.NEW={},l.SELECTED={},l.initialized=!1;var c=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}return function(t,e,n){e&&u(t.prototype,e),n&&u(t,n)}(t,null,[{key:"getCentroidCoordinate",value:function(e){var n,i,o,r,s,a;return e.getType()===M.geom.wkt.type.POINT?n=e.getCoordinates():e.getType()===M.geom.wkt.type.LINE_STRING?n=(i=e.getCoordinates())[o=Math.floor(i.length/2)]:e.getType()===M.geom.wkt.type.LINEAR_RING?n=(i=e.getCoordinates())[o=Math.floor(i.length/2)]:e.getType()===M.geom.wkt.type.POLYGON?n=t.getCentroidCoordinate(e.getInteriorPoint()):e.getType()===M.geom.wkt.type.MULTI_POINT?(r=e.getPoints(),o=Math.floor(r.length/2),n=t.getCentroidCoordinate(r[o])):e.getType()===M.geom.wkt.type.MULTI_LINE_STRING?(s=e.getLineStrings(),o=Math.floor(s.length/2),n=t.getCentroidCoordinate(s[o])):e.getType()===M.geom.wkt.type.MULTI_POLYGON?(r=e.getInteriorPoints(),n=t.getCentroidCoordinate(r)):e.getType()===M.geom.wkt.type.CIRCLE?n=e.getCenter():e.getType()===M.geom.wkt.type.GEOMETRY_COLLECTION&&(a=e.getGeometries(),o=Math.floor(a.length/2),n=t.getCentroidCoordinate(a[o])),n}}]),t}();function h(t){return(h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function p(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function d(t,e){return!e||"object"!==h(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function f(t,e,n){return(f="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var i=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=m(t)););return t}(t,e);if(i){var o=Object.getOwnPropertyDescriptor(i,e);return o.get?o.get.call(n):o.value}})(t,e,n||t)}function m(t){return(m=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function y(t,e){return(y=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var g=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"geosearch",i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var o=i;return(t=d(this,m(e).call(this,o))).wktFormatter_=new ol.format.WKT,t.popup_=null,t.selectedFeatures_=[],o.displayInLayerSwitcher||(o.displayInLayerSwitcher=!1),t.name=n,t}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&y(t,e)}(e,M.impl.layer.Vector),function(t,e,n){e&&p(t.prototype,e),n&&p(t,n)}(e,[{key:"addTo",value:function(t){f(m(e.prototype),"addTo",this).call(this,t),this.ol3Layer.setSource(new ol.source.Vector({useSpatialIndex:!1}))}},{key:"drawResults",value:function(t){var n=this,i=ol.proj.get(this.map.getProjection().code),o=[];M.utils.isNullOrEmpty(t.spatial_response)||(o=t.spatial_response.docs),M.utils.isNullOrEmpty(o)&&(o=t.response.docs);var r=o.map(function(t){var o=n.wktFormatter_.readFeature(t.geom,{dataProjection:i});return o.setId(t.solrid),o.setProperties(t),e.setStyleFeature(o,M.style.state.DEFAULT),n.wrapComplexFeature_(o),M.impl.Feature.olFeature2Facade(o)},this);this.facadeVector_.addFeatures(r)}},{key:"drawNewResults",value:function(t){var n,i=this,o=ol.proj.get(this.map.getProjection().code);M.utils.isNullOrEmpty(t.spatial_response)?M.utils.isNullOrEmpty(t.response)||(n=t.response.docs):n=t.spatial_response.docs;var r=n.map(function(t){var n=i.wktFormatter_.readFeature(t.geom,{dataProjection:o});return n.setId(t.solrid),n.setProperties(t),e.setStyleFeature(n,M.style.state.NEW),M.impl.Feature.olFeature2Facade(n)},this);this.facadeVector_.addFeatures(r)}},{key:"clear",value:function(t){this.map.removePopup(),this.facadeVector_.clear()}},{key:"selectFeatures",value:function(t,n,i,o){var r=this,a=t;this.unselectFeatures(),this.selectedFeatures_=a,a=a.map(M.impl.Feature.facade2OLFeature),e.setStyleFeature(a,M.style.state.SELECTED);var l={jsonp:!0,vars:this.parseFeaturesForTemplate_(a),parseToHtml:!1},u={icon:"g-cartografia-pin",title:"Geosearch",content:M.template.compileSync(s.a,l)},c=this.map.getPopup();M.utils.isNullOrEmpty(c)?((c=new M.Popup({panMapIfOutOfView:!o,ani:null})).addTab(u),this.map.addPopup(c,n)):c.addTab(u),c.on(M.evt.DESTROY,function(){r.internalUnselectFeatures_(!0)},this)}},{key:"selectFeatureBySolrid",value:function(t){var e=this.facadeVector_.getFeatureById(t);this.selectedFeatures_=[e];var n=e.getImpl().getOLFeature().getGeometry(),i=c.getCentroidCoordinate(n);this.unselectFeatures(),this.selectFeatures([e],i,null,!0),this.map.setBbox(n.getExtent())}},{key:"parseFeaturesForTemplate_",value:function(t){var e={features:[]};return t.forEach(function(t){var n=["geom","_version_","keywords","solrid",t.getGeometryName()],i=t.getProperties(),o=[];Object.keys(i).forEach(function(t){M.utils.includes(n,t.toLowerCase())||o.push({key:M.utils.beautifyAttributeName(t),value:i[t]})});var r={solrid:t.getId(),attributes:o};e.features.push(r)}),e}},{key:"wrapComplexFeature_",value:function(t){var e=t.getGeometry();if(e.getType()===M.geom.wkt.type.POLYGON||e.getType()===M.geom.wkt.type.MULTI_POLYGON){var n;n=e.getType()===M.geom.wkt.type.POLYGON?e.getInteriorPoint():e.getInteriorPoints();var i=new ol.geom.GeometryCollection([n,e]);t.setGeometry(i)}}},{key:"unselectFeatures",value:function(t,e){this.internalUnselectFeatures_()}},{key:"internalUnselectFeatures_",value:function(t){this.selectedFeatures_.length>0&&(e.setStyleFeature(this.selectedFeatures_.map(M.impl.Feature.facade2OLFeature),M.style.state.DEFAULT),this.selectedFeatures_.length=0,t||this.map.removePopup())}},{key:"setNewResultsAsDefault",value:function(){e.setStyleFeature(this.facadeVector_.getFeatures().map(M.impl.Feature.facade2OLFeature),M.style.state.DEFAULT)}},{key:"getCentroidCoordinate",value:function(t){var e,n,i,o,r,s;return t.getType()===M.geom.wkt.type.POINT?e=t.getCoordinates():t.getType()===M.geom.wkt.type.LINE_STRING?e=(n=t.getCoordinates())[i=Math.floor(n.length/2)]:t.getType()===M.geom.wkt.type.LINEAR_RING?e=(n=t.getCoordinates())[i=Math.floor(n.length/2)]:t.getType()===M.geom.wkt.type.POLYGON?e=this.getCentroidCoordinate(t.getInteriorPoint()):t.getType()===M.geom.wkt.type.MULTI_POINT?(o=t.getPoints(),i=Math.floor(o.length/2),e=this.getCentroidCoordinate(o[i])):t.getType()===M.geom.wkt.type.MULTI_LINE_STRING?(r=t.getLineStrings(),i=Math.floor(r.length/2),e=this.getCentroidCoordinate(r[i])):t.getType()===M.geom.wkt.type.MULTI_POLYGON?(o=t.getInteriorPoints(),e=this.getCentroidCoordinate(o)):t.getType()===M.geom.wkt.type.CIRCLE?e=t.getCenter():t.getType()===M.geom.wkt.type.GEOMETRY_COLLECTION&&(s=t.getGeometries(),i=Math.floor(s.length/2),e=this.getCentroidCoordinate(s[i])),e}},{key:"destroy",value:function(){var t=this.map.getMapImpl();M.utils.isNullOrEmpty(this.ol3Layer)||(t.removeLayer(this.ol3Layer),this.ol3Layer=null),this.map=null,this.wktFormatter_=null,this.popup_=null,this.selectedFeatures_=null,this.name=null}},{key:"equals",value:function(t){var n=!1;return t instanceof e&&(n=this.url===t.url,n=n&&this.name===t.name),n}}],[{key:"setStyleFeature",value:function(t,e){var n=t;l.init(),M.utils.isArray(n)||(n=[n]),n.forEach(function(t){var n=t.getGeometry().getType();M.utils.isNullOrEmpty(e)||e===M.style.state.DEFAULT?t.setStyle(l.DEFAULT[n]):e===M.style.state.NEW?t.setStyle(l.NEW[n]):e===M.style.state.SELECTED&&t.setStyle(l.SELECTED[n])})}}]),e}();function v(t){return(v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function b(t,e){return!e||"object"!==v(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function E(t){return(E=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function w(t,e){return(w=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}g.POPUP_RESULT="geosearchfeaturepopup.html";var S=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new g;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),t=b(this,E(e).call(this,n,i,{},o)),M.utils.isUndefined(g)&&M.exception("La implementación usada no puede crear capas Geosearch"),t.displayInLayerSwitcher=!1,t}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&w(t,e)}(e,M.layer.Vector),function(t,e,n){e&&_(t.prototype,e),n&&_(t,n)}(e,[{key:"equals",value:function(t){return!1}}]),e}();function L(t){return(L="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function C(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function T(t,e){return!e||"object"!==L(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function O(t){return(O=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function k(t,e){return(k=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var N=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(t=T(this,O(e).call(this))).facadeMap_=null,t.helpHtml_=null,t.layer_=new S({name:n.layerName}),t}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&k(t,e)}(e,M.impl.Control),function(t,e,n){e&&C(t.prototype,e),n&&C(t,n)}(e,[{key:"addTo",value:function(t,e){this.facadeMap_=t,t.addLayers(this.layer_),ol.control.Control.call(this,{element:e,target:null}),t.getMapImpl().addControl(this)}},{key:"unselectResults",value:function(t){this.layer_.getImpl().unselectFeatures(t)}},{key:"setNewResultsAsDefault",value:function(){this.layer_.getImpl().setNewResultsAsDefault()}},{key:"drawResults",value:function(t){this.layer_.getImpl().drawResults(t)}},{key:"drawNewResults",value:function(t){this.layer_.getImpl().drawNewResults(t)}},{key:"zoomToResults",value:function(){var t=ol.extent.boundingExtent(this.layer_.getImpl().getOL3Layer().getSource().getFeatures().map(function(t){return ol.extent.getCenter(t.getGeometry().getExtent())}));this.facadeMap_.setBbox(t)}},{key:"getLayer",value:function(){return this.layer_}},{key:"resultClick",value:function(t){this.layer_.getImpl().selectFeatureBySolrid(t)}},{key:"hideHelp",value:function(){M.utils.isNullOrEmpty(this.helpHtml_)||(this.facadeMap_.getMapImpl().getTargetElement().removeChild(this.helpHtml_),this.helpHtml_=null)}},{key:"showHelp",value:function(t){var e=this.facadeMap_.getMapImpl().getTargetElement();M.utils.isNullOrEmpty(this.helpHtml_)||e.removeChild(this.helpHtml_),this.helpHtml_=t,e.appendChild(this.helpHtml_)}},{key:"clear",value:function(){this.layer_.clear()}},{key:"destroy",value:function(){this.clear(),this.facadeMap_.areasContainer.getElementsByClassName("m-top m-right")[0].classList.remove("top-extra"),this.facadeMap_.getMapImpl().removeControl(this),this.facadeMap_=null,this.helpHtml_=null,this.layer_=null}}]),e}();function P(t){return(P="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function I(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function R(t,e){return!e||"object"!==P(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function D(t,e,n){return(D="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var i=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=F(t)););return t}(t,e);if(i){var o=Object.getOwnPropertyDescriptor(i,e);return o.get?o.get.call(n):o.value}})(t,e,n||t)}function F(t){return(F=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function x(t,e){return(x=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var U=function(t){function e(t){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=R(this,F(e).call(this,{layerName:e.NAME}))).popup_=null,n.searchUrl_=t,n.positionFeature_=new M.Feature,n.positionFeature_.setStyle(new M.style.Point({fill:{color:"#3399CC"},radius:6,stroke:{color:"#fff",width:3}})),n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&x(t,e)}(e,N),function(t,e,n){e&&I(t.prototype,e),n&&I(t,n)}(e,[{key:"setMap",value:function(t){D(F(e.prototype),"setMap",this).call(this,t),M.utils.isNullOrEmpty(t)?this.facadeMap_.getImpl().removeFeatures([this.positionFeature_]):this.map=t}},{key:"drawLocation",value:function(t){this.positionFeature_.getImpl().getOLFeature().setGeometry(t?new ol.geom.Point(t):null),this.facadeMap_.drawFeatures([this.positionFeature_])}},{key:"addResultsContainer",value:function(t){this.map.getTargetElement().appendChild(t)}},{key:"removeResultsContainer",value:function(t){null!==t&&null!=t.parentElement&&t.parentElement.removeChild(t)}},{key:"zoomToResultsAll",value:function(){var t=this.facadeMap_.getControls("geosearchbycoordinates")[0].getImpl().getLayer().getFeaturesExtent();this.facadeMap_.setBbox(t)}},{key:"destroy",value:function(){this.facadeMap_.getMapImpl().removeControl(this),this.clear(),this.facadeMap_.removeFeatures([this.positionFeature_]),this.popup_=null,this.searchUrl_=null}},{key:"deactivate",value:function(){this.facadeMap_.removeFeatures(this.positionFeature_)}}]),e}(),A=n(22),G=n.n(A),j=n(23),H=n.n(j),B=n(24),W=n.n(B),q=n(16),Y=n.n(q),z=n(25),J=n.n(z);function V(t){return(V="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Q(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function $(t,e){return!e||"object"!==V(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function X(t){return(X=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function K(t,e){return(K=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var Z=function(t){function e(t,n,i,o,r){var s;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var a=new N;return s=$(this,X(e).call(this,a,e.NAME)),M.utils.isUndefined(N)&&M.exception("La implementación usada no puede crear controles Geosearch"),s.input_=null,s.element_=null,s.resultsContainer_=null,s.resultsScrollContainer_=null,s.searchingResult_=null,s.searchTime_=0,s.url_=t,s.core_=n,s.handler_=i,s.searchUrl_=M.utils.concatUrlPaths([s.url_,s.core_,s.handler_]),s.helpUrl_=M.utils.concatUrlPaths([s.url_,s.core_,"/help"]),s.searchParameters_=o,M.utils.isNullOrEmpty(s.searchParameters_)||(M.utils.isNullOrEmpty(s.searchParameters_.rows)&&(s.searchParameters_.rows=M.config.GEOSEARCH_ROWS),s.searchUrl_=M.utils.addParameters(s.searchUrl_,s.searchParameters_)),s.results_=[],s.showHelp_=r,s.scrollIsUp_=!0,s.spatialSearch_=!1,s.facadeMap_=null,s}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&K(t,e)}(e,M.Control),function(t,e,n){e&&Q(t.prototype,e),n&&Q(t,n)}(e,[{key:"createView",value:function(t){this.facadeMap_=t;var e=M.template.compileSync(W.a,{jsonp:!0});return!1===this.showHelp_&&e.querySelector("#m-geosearch-help-btn").classList.add("m-hidden"),this.addEvents(e),e}},{key:"addEvents",value:function(t){var e=this;this.element_=t,this.on(M.evt.COMPLETED,function(){e.element_.classList.add("shown")},this),this.input_=this.element_.getElementsByTagName("input")["m-geosearch-search-input"],this.input_.addEventListener("keyup",this.searchClick.bind(this)),this.element_.getElementsByTagName("button")["m-geosearch-search-btn"].addEventListener("click",this.searchClick.bind(this));var n=this.element_.getElementsByTagName("button")["m-geosearch-help-btn"];n&&n.addEventListener("click",function(t){t.preventDefault(),n.classList.toggle("shown"),e.helpClick_()}),this.element_.getElementsByTagName("button")["m-geosearch-clear-btn"].addEventListener("click",this.clearClick_.bind(this)),this.resultsContainer_=this.element_.querySelector("div#m-geosearch-results"),M.utils.enableTouchScroll(this.resultsContainer_),this.searchingResult_=this.element_.querySelector("div#m-geosearch-results > div#m-searching-result")}},{key:"addEventsHelp",value:function(t){this.element_=t,this.element_.getElementsByTagName("button")["m-geosearch-closeHelp-btn"].addEventListener("click",this.closeHelpClick_.bind(this))}},{key:"searchClick",value:function(t){if(t.preventDefault(),"keyup"!==t.type||13===t.keyCode){this.results_.length=0;var e=this.input_.value;M.utils.isNullOrEmpty(e)?M.dialog.info("Debe introducir una búsqueda."):this.search_(e,this.showResults_)}}},{key:"resultClick_",value:function(t){var e=t;e.preventDefault(),M.window.WIDTH<=M.config.MOBILE_WIDTH&&(e.target=this.resultsContainer_.querySelector("div.page > div.g-cartografia-flecha-arriba"),this.resultsClick_(e)),this.facadeMap_.removePopup();var n=e.currentTarget.id;this.getImpl().resultClick(n)}},{key:"search_",value:function(t,n){var i=this;this.resultsContainer_.appendChild(this.searchingResult_),this.searchTime_=Date.now(),this.element_.classList.add(e.SEARCHING_CLASS);var o=M.utils.addParameters(this.searchUrl_,{q:t,start:this.results_.length,srs:this.facadeMap_.getProjection().code});!function(t){M.remote.get(o).then(function(o){if(t===i.searchTime_){var r;try{r=JSON.parse(o.text)}catch(t){M.exception("La respuesta no es un JSON válido: ".concat(t))}n.call(i,r),i.element_.classList.remove(e.SEARCHING_CLASS)}})}(this.searchTime_)}},{key:"showResults_",value:function(t){this.getImpl().clear(),this.drawResults(t);var n={jsonp:!0,vars:this.parseResultsForTemplate_(t)},i=M.template.compileSync(Y.a,n);this.resultsContainer_.classList.remove(e.HIDDEN_RESULTS_CLASS),M.utils.isNullOrEmpty(this.resultsScrollContainer_)||this.resultsScrollContainer_.removeEventListener("scroll",this.resultsScroll_);for(var o=this.resultsContainer_.querySelectorAll(".result"),r=0,s=o.length;r<s;r+=1)o.item(r).removeEventListener("click",this.resultClick_.bind(this));t.response.docs.length>0&&this.zoomToResults();var a=this.resultsContainer_.querySelector("div.page > div.g-cartografia-flecha-arriba");M.utils.isNullOrEmpty(a)||a.removeEventListener("click",this.resultsClick_.bind(this)),this.resultsContainer_.innerHTML=i.innerHTML,this.resultsScrollContainer_=this.resultsContainer_.querySelector("div#m-geosearch-results-scroll"),M.utils.enableTouchScroll(this.resultsScrollContainer_),this.resultsScrollContainer_.addEventListener("scroll",this.resultsScroll_.bind(this));for(var l=0,u=(o=this.resultsContainer_.getElementsByClassName("result")).length;l<u;l+=1)o.item(l).addEventListener("click",this.resultClick_.bind(this));(a=this.resultsContainer_.querySelector("div.page > div.g-cartografia-flecha-arriba")).addEventListener("click",this.resultsClick_.bind(this)),this.checkScrollSearch_(t),this.fire(M.evt.COMPLETED)}},{key:"drawResults",value:function(t){this.getImpl().drawResults(t)}},{key:"drawNewResults",value:function(t){this.getImpl().drawNewResults(t)}},{key:"zoomToResults",value:function(){this.getImpl().zoomToResults()}},{key:"getInput",value:function(){return this.input_}},{key:"appendResults_",value:function(t){var e=this;this.drawNewResults(t);for(var n={jsonp:!0,vars:this.parseResultsForTemplate_(t,!0)},i=M.template.compileSync(Y.a,n).getElementsByTagName("div")["m-geosearch-results-scroll"].children,o=0;o<i.length;o+=1){var r=i.item(o);this.resultsScrollContainer_.appendChild(r),r.addEventListener("click",function(t){return e.resultClick_(t)})}this.resultsContainer_.getElementsByTagName("span")["m-geosearch-page-found"].innerHTML=this.results_.length,this.checkScrollSearch_(t)}},{key:"resultsScroll_",value:function(t){var e=t.target,n=e.offsetHeight,i=e.scrollHeight-e.scrollTop-n<=15;i&&this.scrollIsUp_?(this.scrollIsUp_=!1,this.scrollSearch_()):i||(this.scrollIsUp_=!0)}},{key:"scrollSearch_",value:function(){this.getImpl().unselectResults(!0),this.getImpl().setNewResultsAsDefault();var t=this.input_.value;this.search_(t,this.appendResults_)}},{key:"helpClick_",value:function(t){var e=this;!0===this.helpShown_?(this.getImpl().hideHelp(),this.helpShown_=!1):M.remote.get(this.helpUrl_).then(function(t){var n;try{n=JSON.parse(t.text)}catch(t){M.Exception("La respuesta no es un JSON válido: ".concat(t))}var i={jsonp:!0,vars:{entities:n}},o=M.template.compileSync(J.a,i);e.addEventsHelp(o),e.getImpl().showHelp(o),e.helpShown_=!0})}},{key:"closeHelpClick_",value:function(t){!0===this.helpShown_&&(this.getImpl().hideHelp(),this.helpShown_=!1)}},{key:"clearClick_",value:function(t){this.element_.classList.remove("shown"),M.utils.isNullOrEmpty(this.input_)||(this.input_.value=""),M.utils.isNullOrEmpty(this.resultsContainer_)||(this.resultsContainer_.innerHTML=""),M.utils.isNullOrEmpty(this.resultsScrollContainer_)||(this.resultsScrollContainer_.innerHTML="",this.resultsScrollContainer_=null),this.results_.length=0,this.resultsContainer_.classList.remove(e.HIDDEN_RESULTS_CLASS),this.getImpl().clear(),this.getImpl().hideHelp(),this.spatialSearch_=!1}},{key:"resultsClick_",value:function(t){this.facadeMap_.areasContainer.getElementsByClassName("m-top m-right")[0].classList.add("top-extra-search"),t.target.classList.toggle("g-cartografia-flecha-arriba"),t.target.classList.toggle("g-cartografia-flecha-abajo"),this.resultsContainer_.classList.toggle(e.HIDDEN_RESULTS_CLASS)}},{key:"equals",value:function(t){var n=!1;return t instanceof e&&(n=this.name===t.name),n}},{key:"parseResultsForTemplate_",value:function(t,e){var n="";M.utils.isNullOrEmpty(this.input_)||(n=this.input_.value);var i=0;M.utils.isUndefined(t.spatial_response)?(i=t.response.numFound,this.spatialSearch_=!1):(i=t.spatial_response.numFound,this.spatialSearch_=!0);var o=this.getDocsFromResults_(t);this.results_=!0===e?this.results_.concat(o):o;var r=this.spatialSearch_&&M.utils.isNullOrEmpty(t.spatial_response.docs);return 0!==i?{docs:o,total:i,partial:r}:{docs:o,total:i,notResutls:!0,query:n}}},{key:"getDocsFromResults_",value:function(t){var e=["geom","_version_","keywords","solrid"];return(this.spatialSearch_?t.spatial_response.docs:t.response.docs).map(function(t){var n=[];return Object.keys(t).forEach(function(i){M.utils.includes(e,i)||n.push({key:M.utils.beautifyAttributeName(i),value:t[i]})}),{solrid:t.solrid,attributes:n}})}},{key:"checkScrollSearch_",value:function(t){var e=0;e=M.utils.isUndefined(t.spatial_response)?t.response.numFound:t.spatial_response.numFound,this.results_.length!==e||M.utils.isNullOrEmpty(this.resultsScrollContainer_)||this.resultsScrollContainer_.removeEventListener("scroll",this.resultsScroll_)}}]),e}();function tt(t){return(tt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function et(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function nt(t,e){return!e||"object"!==tt(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function it(t){return(it=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function ot(t,e){return(ot=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}Z.NAME="geosearch",Z.TEMPLATE="geosearch.html",Z.RESULTS_TEMPLATE="geosearchresults.html",Z.HELP_TEMPLATE="geosearchhelp.html",Z.SEARCHING_CLASS="m-searching",Z.HIDDEN_RESULTS_CLASS="hidden";var rt=function(t){function e(t,n,i,o,r,s){var a;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(a=nt(this,it(e).call(this,t,n,i))).impl_=new U(a.searchUrl_),a.activate_=!1,a.activatebtnList_=!0,a.distance_=o,a.spatialField_=r,a.rows_=s,a.searchUrl_=M.utils.concatUrlPaths([t,n,i]),a.facadeMap_=null,a.resultsScrollContainer_=null,M.utils.isUndefined(U)&&M.Exception("La implementación usada no puede crear controles GeosearchByCoordinates"),a.name=e.NAME,a}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&ot(t,e)}(e,Z),function(t,e,n){e&&et(t.prototype,e),n&&et(t,n)}(e,[{key:"equals",value:function(t){var n=!1;return t instanceof e&&(n=this.name===t.name),n}},{key:"createView",value:function(t){var e=this;this.facadeMap_=t,this.facadeMap_.on(M.evt.CLICK,function(t){if(!0===e.activate_){var n=new ol.geom.Point(t.coord),i=(new ol.format.WKT).writeGeometry(n);e.searchFrom(i,t.coord),e.element_.classList.add(Z.SEARCHING_CLASS),e.element_.classList.remove("ready"),e.activated=!1,e.activate_=!1}});var n=M.template.compileSync(G.a,{jsonp:!0});return n.querySelector("button#m-geosearchbycoordinates-button-list").onclick=this.showList_.bind(this),n}},{key:"getActivationButton",value:function(t){return t.querySelector("button#m-geosearchbycoordinates-button")}},{key:"activate",value:function(){this.activate_=!0,this.element_.classList.add("ready")}},{key:"deactivate",value:function(){this.thereIsSearch=!1,this.activate_=!1,this.element_.classList.remove("activated"),this.element_.classList.remove("ready"),this.getImpl().clear(),this.getImpl().removeResultsContainer(this.resultsContainer_),this.getImpl().deactivate()}},{key:"drawLocation_",value:function(t){this.getImpl().drawLocation(t)}},{key:"searchFrom",value:function(t,e){var n,i=this;n=M.utils.addParameters(this.searchUrl_,{wt:"json",pt:t,q:"*:*",start:0,d:this.distance_,spatialField:this.spatialField_,rows:this.rows_,srs:this.map_.getProjection().code}),this.searchTime_=Date.now(),function(t){M.remote.get(n).then(function(n){if(t===i.searchTime_){var o;try{o=JSON.parse(n.text)}catch(t){M.Exception("La respuesta no es un JSON válido:".concat(t))}i.getImpl().removeResultsContainer(i.resultsContainer_),i.showResults_(o),i.drawLocation_(e),i.zoomToResultsAll_(),i.activationBtn_.classList.remove(Z.HIDDEN_RESULTS_CLASS),i.element_.classList.remove(Z.SEARCHING_CLASS)}})}(this.searchTime_)}},{key:"zoomToResultsAll_",value:function(){this.getImpl().zoomToResultsAll()}},{key:"showResults_",value:function(t){this.getImpl().clear(),this.results=t,this.showList=!0,this.thereIsSearch=!0,this.drawResults(t)}},{key:"showList_",value:function(){var t=this;if(this.thereIsSearch)if(!0===this.showList){var e={jsonp:!0,vars:this.parseResultsForTemplate_(this.results)},n=M.template.compileSync(H.a,e);this.draggable_=new o.a(n,{containment:".m-mapea-container",handle:".m-geosearchbycoordinates-results-panel .title"}),this.draggable_.enable(),n.style.position="absolute",this.resultsContainer_=n,this.resultsScrollContainer_=this.resultsContainer_.querySelector("div#m-geosearchbycoordinates-results-scroll"),M.utils.enableTouchScroll(this.resultsScrollContainer_),this.getImpl().addResultsContainer(this.resultsContainer_);for(var i=this.resultsContainer_.getElementsByClassName("result"),r=0,s=i.length;r<s;r+=1){i.item(r).addEventListener("click",function(e){t.resultClick_(e),t.getImpl().removeResultsContainer(t.resultsContainer_),t.showList=!0})}n.querySelector(".title > button.m-panel-btn").addEventListener("click",this.showList_.bind(this)),this.showList=!1}else this.getImpl().removeResultsContainer(this.resultsContainer_),this.showList=!0;else M.dialog.info("No se ha realizado ninguna búsqueda.","Sin información")}},{key:"resultsClick_",value:function(t){this.resultsContainer_.classList.toggle(Z.HIDDEN_RESULTS_CLASS)}}]),e}();rt.NAME="geosearchbycoordinates",rt.HIDDEN="hidden",rt.TEMPLATE="geosearchbycoordinates.html",rt.RESULTS_TEMPLATE="GeosearchByCoordinatesresults.html";var st=n(26);function at(t){return(at="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function lt(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function ut(t,e){return!e||"object"!==at(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function ct(t){return(ct=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function ht(t,e){return(ht=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var pt=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(t=ut(this,ct(e).call(this))).name=e.NAME,t.url_=M.config.GEOSEARCH_URL,M.utils.isNullOrEmpty(n.url)||(t.url_=n.url),t.core_=M.config.GEOSEARCH_CORE,M.utils.isNullOrEmpty(n.core)||(t.core_=n.core),t.handler_=M.config.GEOSEARCH_HANDLER,M.utils.isNullOrEmpty(n.handler)||(t.handler_=n.handler),t.distance_=M.config.GEOSEARCH_DISTANCE,M.utils.isNullOrEmpty(n.distance)||(t.distance_=n.distance),t.spatialField_=M.config.GEOSEARCH_SPATIAL_FIELD,t.rows_=M.config.GEOSEARCHBYLOCATION_ROWS,t.map_=null,t.controlGeo_=null,t.panel_=null,t.metadata_=st.metadata,t}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&ht(t,e)}(e,M.Plugin),function(t,e,n){e&&lt(t.prototype,e),n&&lt(t,n)}(e,[{key:"addTo",value:function(t){this.map_=t,this.controlGeo_=new rt(this.url_,this.core_,this.handler_,this.distance_,this.spatialField_,this.rows_),this.panel_=new M.ui.Panel(e.NAME,{collapsible:!1,className:"m-geosearchbylocation",position:M.ui.position.BR});var n=t.getPanels([M.control.Location.NAME])[0];M.utils.isNullOrEmpty(n)||M.utils.isNullOrEmpty(void 0)?M.utils.isNullOrEmpty(n)?M.utils.isNullOrEmpty(void 0)||((void 0).addClassName("m-with-geosearchbylocation"),this.panel_.addClassName("m-with-streetview")):(n.addClassName("m-with-geosearchbylocation"),this.panel_.addClassName("m-with-location")):(n.addClassName("m-with-geosearchbylocation"),(void 0).addClassName("m-with-geosearchbylocation"),this.panel_.addClassName("m-with-location m-with-streetview")),this.panel_.addControls(this.controlGeo_),this.map_.addPanels(this.panel_)}},{key:"destroy",value:function(){this.map_.removeControls([this.controlGeo_]),this.controlGeo_=null,this.name=null,this.url_=null,this.core_=null,this.handler_=null,this.distance_=null,this.spatialField_=null,this.rows_=null,this.map_=null,this.controlGeo_=null,this.panel_=null}},{key:"getControls",value:function(){var t=[];return t.push(this.controlGeo_),t}},{key:"equals",value:function(t){return t instanceof e}},{key:"getMetadata",value:function(){return this.metadata_}}]),e}();pt.NAME="geosearchbylocation",null==window.M.plugin&&(window.M.plugin={}),window.M.plugin.GeosearchByCoordinates=pt},8:function(t,e,n){var i,o;
/*!
 * Draggabilly v2.2.0
 * Make that shiz draggable
 * https://draggabilly.desandro.com
 * MIT license
 */
/*!
 * Draggabilly v2.2.0
 * Make that shiz draggable
 * https://draggabilly.desandro.com
 * MIT license
 */
!function(r,s){i=[n(12),n(13)],void 0===(o=function(t,e){return function(t,e,n){"use strict";function i(t,e){for(var n in e)t[n]=e[n];return t}var o=t.jQuery;function r(t,e){this.element="string"==typeof t?document.querySelector(t):t,o&&(this.$element=o(this.element)),this.options=i({},this.constructor.defaults),this.option(e),this._create()}var s=r.prototype=Object.create(n.prototype);r.defaults={},s.option=function(t){i(this.options,t)};var a={relative:!0,absolute:!0,fixed:!0};function l(t,e,n){return n=n||"round",e?Math[n](t/e)*e:t}s._create=function(){this.position={},this._getPosition(),this.startPoint={x:0,y:0},this.dragPoint={x:0,y:0},this.startPosition=i({},this.position);var t=getComputedStyle(this.element);a[t.position]||(this.element.style.position="relative"),this.on("pointerDown",this.onPointerDown),this.on("pointerMove",this.onPointerMove),this.on("pointerUp",this.onPointerUp),this.enable(),this.setHandles()},s.setHandles=function(){this.handles=this.options.handle?this.element.querySelectorAll(this.options.handle):[this.element],this.bindHandles()},s.dispatchEvent=function(t,e,n){var i=[e].concat(n);this.emitEvent(t,i),this.dispatchJQueryEvent(t,e,n)},s.dispatchJQueryEvent=function(e,n,i){var o=t.jQuery;if(o&&this.$element){var r=o.Event(n);r.type=e,this.$element.trigger(r,i)}},s._getPosition=function(){var t=getComputedStyle(this.element),e=this._getPositionCoord(t.left,"width"),n=this._getPositionCoord(t.top,"height");this.position.x=isNaN(e)?0:e,this.position.y=isNaN(n)?0:n,this._addTransformPosition(t)},s._getPositionCoord=function(t,n){if(-1!=t.indexOf("%")){var i=e(this.element.parentNode);return i?parseFloat(t)/100*i[n]:0}return parseInt(t,10)},s._addTransformPosition=function(t){var e=t.transform;if(0===e.indexOf("matrix")){var n=e.split(","),i=0===e.indexOf("matrix3d")?12:4,o=parseInt(n[i],10),r=parseInt(n[i+1],10);this.position.x+=o,this.position.y+=r}},s.onPointerDown=function(t,e){this.element.classList.add("is-pointer-down"),this.dispatchJQueryEvent("pointerDown",t,[e])},s.dragStart=function(t,e){this.isEnabled&&(this._getPosition(),this.measureContainment(),this.startPosition.x=this.position.x,this.startPosition.y=this.position.y,this.setLeftTop(),this.dragPoint.x=0,this.dragPoint.y=0,this.element.classList.add("is-dragging"),this.dispatchEvent("dragStart",t,[e]),this.animate())},s.measureContainment=function(){var t=this.getContainer();if(t){var n=e(this.element),i=e(t),o=this.element.getBoundingClientRect(),r=t.getBoundingClientRect(),s=i.borderLeftWidth+i.borderRightWidth,a=i.borderTopWidth+i.borderBottomWidth,l=this.relativeStartPosition={x:o.left-(r.left+i.borderLeftWidth),y:o.top-(r.top+i.borderTopWidth)};this.containSize={width:i.width-s-l.x-n.width,height:i.height-a-l.y-n.height}}},s.getContainer=function(){var t=this.options.containment;if(t)return t instanceof HTMLElement?t:"string"==typeof t?document.querySelector(t):this.element.parentNode},s.onPointerMove=function(t,e,n){this.dispatchJQueryEvent("pointerMove",t,[e,n])},s.dragMove=function(t,e,n){if(this.isEnabled){var i=n.x,o=n.y,r=this.options.grid,s=r&&r[0],a=r&&r[1];i=l(i,s),o=l(o,a),i=this.containDrag("x",i,s),o=this.containDrag("y",o,a),i="y"==this.options.axis?0:i,o="x"==this.options.axis?0:o,this.position.x=this.startPosition.x+i,this.position.y=this.startPosition.y+o,this.dragPoint.x=i,this.dragPoint.y=o,this.dispatchEvent("dragMove",t,[e,n])}},s.containDrag=function(t,e,n){if(!this.options.containment)return e;var i="x"==t?"width":"height",o=l(-this.relativeStartPosition[t],n,"ceil"),r=this.containSize[i];return r=l(r,n,"floor"),Math.max(o,Math.min(r,e))},s.onPointerUp=function(t,e){this.element.classList.remove("is-pointer-down"),this.dispatchJQueryEvent("pointerUp",t,[e])},s.dragEnd=function(t,e){this.isEnabled&&(this.element.style.transform="",this.setLeftTop(),this.element.classList.remove("is-dragging"),this.dispatchEvent("dragEnd",t,[e]))},s.animate=function(){if(this.isDragging){this.positionDrag();var t=this;requestAnimationFrame(function(){t.animate()})}},s.setLeftTop=function(){this.element.style.left=this.position.x+"px",this.element.style.top=this.position.y+"px"},s.positionDrag=function(){this.element.style.transform="translate3d( "+this.dragPoint.x+"px, "+this.dragPoint.y+"px, 0)"},s.staticClick=function(t,e){this.dispatchEvent("staticClick",t,[e])},s.setPosition=function(t,e){this.position.x=t,this.position.y=e,this.setLeftTop()},s.enable=function(){this.isEnabled=!0},s.disable=function(){this.isEnabled=!1,this.isDragging&&this.dragEnd()},s.destroy=function(){this.disable(),this.element.style.transform="",this.element.style.left="",this.element.style.top="",this.element.style.position="",this.unbindHandles(),this.$element&&this.$element.removeData("draggabilly")},s._init=function(){},o&&o.bridget&&o.bridget("draggabilly",r);return r}(r,t,e)}.apply(e,i))||(t.exports=o)}(window)}});